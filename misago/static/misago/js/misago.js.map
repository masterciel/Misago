{"version":3,"sources":["misago.js"],"names":["window","Misago","ns","Object","getPrototypeOf","this","self","preloaded_data","SETTINGS","_services","addService","name","factory","order","push","item","after","get","before","_initServices","services","ordered_services","OrderedList","forEach","undefined","service_instance","_destroyServices","reverse","destroy","registerCoreServices","Conf","RouterFactory","Outlet","component","arguments_array","i","arguments","length","m","apply","_outlet","init","outlet","ForumLayout","view","ctrl","_","ForumNavbar","prototype","desktop_navbar","settings","forum_branding_display","href","router","url","src","static_url","alt","forum_name","forum_branding_text","mount","document","getElementById","prefixUrl","prefix","Router","base_url","$","attr","media_url","has","obj","key","hasOwnProperty","value","pop","returnValue","items","is_ordered","_items","add","values","values_only","_order","unordered","insertItem","insertAt","ordering","indexOf","ordered","splice","index","iterations"],"mappings":"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","file":"misago.js","sourcesContent":["/* global -Misago */\n/* exported Misago */\n(function () {\n  'use strict';\n\n  window.Misago = function() {\n\n    var ns = Object.getPrototypeOf(this);\n    var self = this;\n\n    // Preloaded data\n    this.preloaded_data = {\n      // Empty settings\n      SETTINGS: {}\n    };\n\n    // Services\n    this._services = [];\n    this.addService = function(name, factory, order) {\n      this._services.push({\n        name: name,\n        item: factory,\n        after: this.get(order, 'after'),\n        before: this.get(order, 'before')\n      });\n    };\n\n    this._initServices = function(services) {\n      var ordered_services = new ns.OrderedList(services).order(false);\n      ordered_services.forEach(function (item) {\n        var factory = null;\n        if (item.item.factory !== undefined) {\n          factory = item.item.factory;\n        } else {\n          factory = item.item;\n        }\n\n        var service_instance = factory(self);\n        if (service_instance) {\n          self[item.name] = service_instance;\n        }\n      });\n    };\n\n    this._destroyServices = function(services) {\n      var ordered_services = new ns.OrderedList(services).order();\n      ordered_services.reverse();\n      ordered_services.forEach(function (item) {\n        if (item.destroy !== undefined) {\n          item.destroy(self);\n        }\n      });\n    };\n\n    this.registerCoreServices = function() {\n      this.addService('conf', ns.Conf);\n      this.addService('router', ns.RouterFactory);\n      this.addService('outlet', ns.Outlet);\n    };\n\n    // Component factory\n    this.component = function() {\n      var arguments_array = [];\n      for (var i = 0; i < arguments.length; i += 1) {\n        arguments_array.push(arguments[i]);\n      }\n\n      if (arguments_array[arguments_array.length - 1] !== this) {\n        arguments_array.push(this);\n      }\n\n      return m.component.apply(undefined, arguments_array);\n    };\n\n    // App ini/destory\n    this._outlet = null;\n    this.init = function(outlet) {\n      this._outlet = outlet || null;\n      this._initServices(this._services);\n    };\n\n    this.destroy = function() {\n      this._destroyServices();\n    };\n  };\n}());\n\n(function (ns) {\n  'use strict';\n\n  ns.ForumLayout = {\n    view: function(ctrl, _) {\n      return [\n        _.component(ns.ForumNavbar)\n      ];\n    }\n  };\n}(Misago.prototype));\n\n(function (ns) {\n  'use strict';\n\n  ns.ForumNavbar = {\n    view: function(ctrl, _) {\n      var desktop_navbar = [];\n\n      if (_.settings.forum_branding_display) {\n        desktop_navbar.push(\n          m('a.navbar-brand', {href: _.router.url('misago:index')}, [\n            m('img', {\n              src: _.router.static_url('misago/img/site-logo.png'),\n              alt: _.settings.forum_name\n            }),\n            _.settings.forum_branding_text\n          ])\n        );\n      }\n\n      return m('nav.navbar.navbar-default.navbar-static-top[role=\"navigation\"]', [\n        m('.container.hidden-xs.hidden-sm', desktop_navbar)\n      ]);\n    }\n  };\n}(Misago.prototype));\n\n(function (ns) {\n  'use strict';\n\n  ns.Conf = function(_) {\n    _.settings = _.get(_.preloaded_data, 'SETTINGS', {});\n  };\n}(Misago.prototype));\n\n(function (ns) {\n  'use strict';\n\n  ns.Outlet = {\n    factory: function(_) {\n      if (_._outlet) {\n        m.mount(document.getElementById(_._outlet),\n                _.component(ns.ForumLayout));\n      }\n    },\n\n    destroy: function(_) {\n      if (_._outlet) {\n        m.mount(_._outlet, null);\n      }\n    }\n  };\n}(Misago.prototype));\n\n(function (ns) {\n  'use strict';\n\n  var prefixUrl = function(prefix) {\n    return function(url) {\n      return prefix + url;\n    };\n  };\n\n  var Router = function(_) {\n    this.base_url = $('base').attr('href');\n\n    // Media/Static url functions\n    this.static_url = prefixUrl(_.get(_.preloaded_data, 'STATIC_URL', '/'));\n    this.media_url = prefixUrl(_.get(_.preloaded_data, 'MEDIA_URL', '/'));\n  };\n\n  ns.RouterFactory = function(_) {\n    return new Router(_);\n  };\n}(Misago.prototype));\n\n(function (ns) {\n  'use strict';\n\n  ns.has = function(obj, key) {\n    if (obj !== undefined) {\n      return obj.hasOwnProperty(key);\n    } else {\n      return false;\n    }\n  };\n\n  ns.get = function(obj, key, value) {\n    if (ns.has(obj, key)) {\n      return obj[key];\n    } else if (value !== undefined) {\n      return value;\n    } else {\n      return undefined;\n    }\n  };\n\n  ns.pop = function(obj, key, value) {\n    var returnValue = ns.get(obj, key, value);\n    if (ns.has(obj, key)) {\n      delete obj[key];\n    }\n    return returnValue;\n  };\n}(Misago.prototype));\n\n(function (ns) {\n  'use strict';\n\n  ns.OrderedList = function(items) {\n    this.is_ordered = false;\n    this._items = items || [];\n\n    this.add = function(key, item, order) {\n      this._items.push({\n        key: key,\n        item: item,\n        after: ns.get(order, 'after'),\n        before: ns.get(order, 'before')\n      });\n    };\n\n    this.get = function(key, value) {\n      for (var i = 0; i < this._items.length; i++) {\n        if (this._items[i].key === key) {\n          return this._items[i].item;\n        }\n      }\n\n      return value;\n    };\n\n    this.has = function(key) {\n      return this.get(key) !== undefined;\n    };\n\n    this.values = function() {\n      var values = [];\n      for (var i = 0; i < this._items.length; i++) {\n        values.push(this._items[i].item);\n      }\n      return values;\n    };\n\n    this.order = function(values_only) {\n      if (!this.is_ordered) {\n        this._items = this._order(this._items);\n        this.is_ordered = true;\n      }\n\n      if (values_only || typeof values_only === 'undefined') {\n        return this.values();\n      } else {\n        return this._items;\n      }\n    };\n\n    this._order = function(unordered) {\n      // Index of unordered items\n      var index = [];\n      unordered.forEach(function (item) {\n        index.push(item.key);\n      });\n\n      // Ordered items\n      var ordered = [];\n      var ordering = [];\n\n      // First pass: register items that\n      // don't specify their order\n      unordered.forEach(function (item) {\n        if (!item.after && !item.before) {\n          ordered.push(item);\n          ordering.push(item.key);\n        }\n      });\n\n      // Second pass: keep iterating items\n      // until we hit iterations limit or finish\n      // ordering list\n      function insertItem(item) {\n        var insertAt = -1;\n        if (ordering.indexOf(item.key) === -1) {\n          if (item.after) {\n            insertAt = ordering.indexOf(item.after);\n            if (insertAt !== -1) {\n              insertAt += 1;\n            }\n          } else if (item.before) {\n            insertAt = ordering.indexOf(item.before);\n          }\n\n          if (insertAt !== -1) {\n            ordered.splice(insertAt, 0, item);\n            ordering.splice(insertAt, 0, item.key);\n          }\n        }\n      }\n\n      var iterations = 200;\n      while (iterations > 0 && index.length !== ordering.length) {\n        iterations -= 1;\n        unordered.forEach(insertItem);\n      }\n\n      return ordered;\n    };\n  };\n} (Misago.prototype));\n"],"sourceRoot":"/source/"}