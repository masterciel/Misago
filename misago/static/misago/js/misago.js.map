{"version":3,"sources":["misago.js"],"names":["window","Misago","ns","Object","getPrototypeOf","this","self","_initServices","services","orderedServices","OrderedList","order","forEach","item","factory","undefined","serviceInstance","key","_destroyServices","reverse","destroy","context","SETTINGS","setup","init","fixture","get","test","api","_services","proto","prototype","addService","name","push","after","before","has","obj","hasOwnProperty","value","pop","returnValue","persistent","el","isInit","retain","input","kwargs","options","disabled","config","placeholder","autocomplete","element","id","type","oninput","m","withAttr","noop","stateHooks","component","loadingState","errorState","_hasLifecycleHooks","isActive","_controller","controller","apply","arguments","_onunload","onunload","vm","loading","loadingHandler","bind","_view","view","isReady","errorHandler","_init","initArgs","promise","then","ondata","finalArgs","i","length","f","error","items","isOrdered","_items","add","values","values_only","_order","unordered","insertItem","insertAt","ordering","indexOf","ordered","splice","index","iterations","serializeDatetime","serialized","format","deserializeDatetime","deserialized","moment","startsWith","string","beginning","endsWith","tail","UrlConf","_patterns","patterns","prefixPattern","prefix","pattern","replace","include","url","loadingPage","_","getCsrfToken","cookie_name","document","cookie","cookieRegex","RegExp","match","split","Ajax","refreshCsrfToken","csrfToken","CSRF_COOKIE_NAME","runningGets","ajax","method","data","progress","deferred","ajax_settings","headers","X-CSRFToken","dataType","success","resolve","jqXHR","rejection","responseJSON","status","statusText","reject","$","preloaded","post","patch","put","ALERT_BASE_DISPLAY_TIME","ALERT_LENGTH_FACTOR","ALERT_MAX_DISPLAY_TIME","ALERT_HIDE_ANIMATION_LENGTH","Alert","message","isVisible","show","displayTime","runloop","runOnce","startComputation","endComputation","set","stop","info","warning","filtersUrl","filters","encodedKey","encodeURIComponent","encodedValue","join","Query","call","path","related","model","relation","endpoint","results","map","models","Api","alert","gettext","detail","Auth","user","deserialize","NoCaptcha","load","QACaptcha","question","prop","label","labelClass","controlClass","control","validate","form","isBusy","validation","errors","validationKey","helpText","help_text","validator","ReCaptcha","included","wait","grecaptcha","reset","controlConfig","render","sitekey","settings","recaptcha_site_key","getResponse","clean","captcha","Captcha","types","no","qa","re","captcha_type","_components","argumentsArray","boilerplate","_submit","submit","_success","_error","hasErrors","constructor","_forms","mount","getElementById","script","remote","STATIC_URL","cache","Modal","delegateName","on","hide","off","removeClass","remove","modal","open","_modal","_modals","Models","classes","deserializers","relations","json","locale","attr","Router","baseUrl","staticUrl","mediaUrl","urls","reverses","populatePatterns","urlconf","finalPattern","route","startRouting","mode","delegateElement","cleanUrl","isRelative","substr","location","protocol","host","avatarsUrl","delegateClicks","e","target","href","preventDefault","prefixUrl","error403","ban","error404","error500","error0","errorPage","router","_hasRouteBoilerplate","loadingView","container","_routes","RunLoop","_intervals","stopInterval","clearTimeout","run","callable","delay","setTimeout","result","loop","ticks","PageTitle","forum_name","title","_set_complex","completeTitle","page","page_label","interpolate","parent","EMAIL","USERNAME","validators","required","trim","email","minLength","limit_value","returnMessage","ngettext","show_value","maxLength","usernameMinLength","username_length_min","usernameMaxLength","username_length_max","usernameContent","passwordMinLenght","password_length_min","validateField","validateForm","isValid","Zxcvbn","scorePassword","password","inputs","zxcvbn","score","Ban","html","plain","expires_on","deserializeBan","class","LegalPage","body","link","User","isAuthenticated","isAnonymous","slug","username","acl","rank","deserializeUser","joined_on","error_message","help","code","icon","errorBanned","ctrl","trust","expirationMessage","isAfter","fromNow","forum_index_title","active","activation","admin","onclick","legalPageFactory","typeName","defaultTitle","dashedTypeName","isMenuVisible","forum_footnote","terms_of_service","terms_of_service_link","privacy_policy","privacy_policy_link","footer","nav","legalLink","legalType","menu","branding","header","data-dismiss","aria-label","aria-hidden","refresh","reload","registerComplete","messageHtml","inactive","lead","register","footnote","termsUrl","terms","onsubmit","style","signin","navbar","brand","children","src","alt","showSignIn","showRegister","account_activation","sync","forum_branding_display","forum_branding_text","logout","button","textFields","formGroup","groupClass","controlType","attrs","controlId","feedbackId","feedbackIcon","showFeedbackIcon","isValidated","String","for","labelFor","forumLayout","loader","markup","content","tabindex","aria-labelledby","styles","labels","passwordStrength","role","aria-valuenow","aria-valuemin","aria-valuemax","Register","showActivation","extend","SignIn","$form","find","val"],"mappings":"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","file":"misago.js","sourcesContent":["/* global -Misago */\n/* exported Misago */\n(function () {\n  'use strict';\n\n  window.Misago = function() {\n    var ns = Object.getPrototypeOf(this);\n    var self = this;\n\n    // Services init/destroy\n    this._initServices = function(services) {\n      var orderedServices = new ns.OrderedList(services).order(false);\n      orderedServices.forEach(function (item) {\n        var factory = null;\n        if (item.item.factory !== undefined) {\n          factory = item.item.factory;\n        } else {\n          factory = item.item;\n        }\n\n        var serviceInstance = factory(self);\n        if (serviceInstance) {\n          self[item.key] = serviceInstance;\n        }\n      });\n    };\n\n    this._destroyServices = function(services) {\n      var orderedServices = new ns.OrderedList(services).order();\n      orderedServices.reverse();\n      orderedServices.forEach(function (item) {\n        if (item.destroy !== undefined) {\n          item.destroy(self);\n        }\n      });\n    };\n\n    // Context data\n    this.context = {\n      // Empty settings\n      SETTINGS: {}\n    };\n\n    // App init/destory\n    this.setup = false;\n    this.init = function(setup, context) {\n      this.setup = {\n        fixture: ns.get(setup, 'fixture', null),\n        test: ns.get(setup, 'test', false),\n        api: ns.get(setup, 'api', '/api/')\n      };\n\n      if (context) {\n        this.context = context;\n      }\n\n      this._initServices(ns._services);\n    };\n\n    this.destroy = function() {\n      this._destroyServices(ns._services);\n    };\n  };\n\n\n  // Services\n  var proto = window.Misago.prototype;\n\n  proto._services = [];\n  proto.addService = function(name, factory, order) {\n    proto._services.push({\n      key: name,\n      item: factory,\n      after: proto.get(order, 'after'),\n      before: proto.get(order, 'before')\n    });\n  };\n}());\n\n(function (Misago) {\n  'use strict';\n\n  Misago.has = function(obj, key) {\n    if (obj) {\n      return obj.hasOwnProperty(key);\n    } else {\n      return false;\n    }\n  };\n\n  Misago.get = function(obj, key, value) {\n    if (Misago.has(obj, key)) {\n      return obj[key];\n    } else if (value !== undefined) {\n      return value;\n    } else {\n      return undefined;\n    }\n  };\n\n  Misago.pop = function(obj, key, value) {\n    var returnValue = Misago.get(obj, key, value);\n    if (Misago.has(obj, key)) {\n      obj[key] = null;\n    }\n    return returnValue;\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  function persistent(el, isInit, context) {\n    context.retain = true;\n  }\n\n  Misago.input = function(kwargs) {\n    var options = {\n      disabled: kwargs.disabled || false,\n      config: kwargs.config || persistent\n    };\n\n    if (kwargs.placeholder) {\n      options.placeholder = kwargs.placeholder;\n    }\n\n    if (kwargs.autocomplete === false) {\n      options.autocomplete = 'off';\n    }\n\n    var element = 'input';\n\n    if (kwargs.id) {\n      element += '#' + kwargs.id;\n      options.key = 'field-' + kwargs.id;\n    }\n\n    element += '.form-control' + (kwargs.class || '');\n    element += '[type=\"' + (kwargs.type || 'text') + '\"]';\n\n    if (kwargs.value) {\n      options.value = kwargs.value();\n      options.oninput = m.withAttr('value', kwargs.value);\n    }\n\n    return m(element, options);\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var noop = function() {};\n\n  Misago.stateHooks = function(component, loadingState, errorState) {\n    /*\n      Boilerplate for Misago components with lifecycles\n    */\n\n    // Component boilerplated (this may happen in tests)\n    if (component._hasLifecycleHooks) {\n      return component;\n    }\n    component._hasLifecycleHooks = true;\n\n    // Component active state\n    component.isActive = true;\n\n    // Wrap controller to store lifecycle methods\n    var _controller = component.controller || noop;\n    component.controller = function() {\n      component.isActive = true;\n\n      var controller = _controller.apply(component, arguments) || {};\n\n      // wrap onunload for lifestate\n      var _onunload = controller.onunload || noop;\n      controller.onunload = function() {\n        _onunload.apply(component, arguments);\n        component.isActive = false;\n      };\n\n      return controller;\n    };\n\n    // Add state callbacks to View-Model\n    if (component.vm && component.vm.init) {\n      // setup default loading view\n      if (!component.loading) {\n        var loadingHandler = loadingState.bind(component);\n        component.loading = loadingHandler;\n      }\n\n      var _view = component.view;\n      component.view = function() {\n        if (component.vm.isReady) {\n          return _view.apply(component, arguments);\n        } else {\n          return component.loading.apply(component, arguments);\n        }\n      };\n\n      var errorHandler = errorState.bind(component);\n\n      // wrap vm.init in promise handler\n      var _init = component.vm.init;\n      component.vm.init = function() {\n        var initArgs = arguments;\n        var promise = _init.apply(component.vm, initArgs);\n\n        if (promise) {\n          promise.then(function() {\n            if (component.isActive && component.vm.ondata) {\n              var finalArgs = [];\n              for (var i = 0; i < arguments.length; i++) {\n                finalArgs.push(arguments[i]);\n              }\n              for (var f = 0; f < initArgs.length; f++) {\n                finalArgs.push(initArgs[f]);\n              }\n\n              component.vm.ondata.apply(component.vm, finalArgs);\n            }\n          }, function(error) {\n            if (component.isActive) {\n              errorHandler(error);\n            }\n          });\n        }\n      };\n    }\n\n    return component;\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.OrderedList = function(items) {\n    this.isOrdered = false;\n    this._items = items || [];\n\n    this.add = function(key, item, order) {\n      this._items.push({\n        key: key,\n        item: item,\n        after: Misago.get(order, 'after'),\n        before: Misago.get(order, 'before')\n      });\n    };\n\n    this.get = function(key, value) {\n      for (var i = 0; i < this._items.length; i++) {\n        if (this._items[i].key === key) {\n          return this._items[i].item;\n        }\n      }\n\n      return value;\n    };\n\n    this.has = function(key) {\n      return this.get(key) !== undefined;\n    };\n\n    this.values = function() {\n      var values = [];\n      for (var i = 0; i < this._items.length; i++) {\n        values.push(this._items[i].item);\n      }\n      return values;\n    };\n\n    this.order = function(values_only) {\n      if (!this.isOrdered) {\n        this._items = this._order(this._items);\n        this.isOrdered = true;\n      }\n\n      if (values_only || typeof values_only === 'undefined') {\n        return this.values();\n      } else {\n        return this._items;\n      }\n    };\n\n    this._order = function(unordered) {\n      // Index of unordered items\n      var index = [];\n      unordered.forEach(function (item) {\n        index.push(item.key);\n      });\n\n      // Ordered items\n      var ordered = [];\n      var ordering = [];\n\n      // First pass: register items that\n      // don't specify their order\n      unordered.forEach(function (item) {\n        if (!item.after && !item.before) {\n          ordered.push(item);\n          ordering.push(item.key);\n        }\n      });\n\n      // Second pass: register items that\n      // specify their before to \"_end\"\n      unordered.forEach(function (item) {\n        if (item.before === \"_end\") {\n          ordered.push(item);\n          ordering.push(item.key);\n        }\n      });\n\n      // Third pass: keep iterating items\n      // until we hit iterations limit or finish\n      // ordering list\n      function insertItem(item) {\n        var insertAt = -1;\n        if (ordering.indexOf(item.key) === -1) {\n          if (item.after) {\n            insertAt = ordering.indexOf(item.after);\n            if (insertAt !== -1) {\n              insertAt += 1;\n            }\n          } else if (item.before) {\n            insertAt = ordering.indexOf(item.before);\n          }\n\n          if (insertAt !== -1) {\n            ordered.splice(insertAt, 0, item);\n            ordering.splice(insertAt, 0, item.key);\n          }\n        }\n      }\n\n      var iterations = 200;\n      while (iterations > 0 && index.length !== ordering.length) {\n        iterations -= 1;\n        unordered.forEach(insertItem);\n      }\n\n      return ordered;\n    };\n  };\n} (Misago.prototype));\n\n(function (Misago) {\n  Misago.serializeDatetime = function(serialized) {\n    return serialized ? serialized.format() : null;\n  };\n\n  Misago.deserializeDatetime = function(deserialized) {\n    return deserialized ? moment(deserialized) : null;\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.startsWith = function(string, beginning) {\n    return string.indexOf(beginning) === 0;\n  };\n\n  Misago.endsWith = function(string, tail) {\n    return string.indexOf(tail, string.length - tail.length) !== -1;\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.UrlConf = function() {\n    var self = this;\n    this._patterns = [];\n\n    this.patterns = function() {\n      return this._patterns;\n    };\n\n    var prefixPattern = function(prefix, pattern) {\n      return (prefix + pattern).replace('//', '/');\n    };\n\n    var include = function(prefix, patterns) {\n      for (var i = 0; i < patterns.length; i ++) {\n        self.url(prefixPattern(prefix, patterns[i].pattern),\n                 patterns[i].component,\n                 patterns[i].name);\n      }\n    };\n\n    this.url = function(pattern, component, name) {\n      if (pattern === '') {\n        pattern = '/';\n      }\n\n      if (component instanceof Misago.UrlConf) {\n        include(pattern, component.patterns());\n      } else {\n        this._patterns.push({\n          pattern: pattern,\n          component: component.replace(/_/g, '-'),\n          name: name || component\n        });\n      }\n    };\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.loadingPage = function(_) {\n    return m('.page.page-loading',\n      _.component('loader')\n    );\n  };\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var getCsrfToken = function(cookie_name) {\n    if (document.cookie.indexOf(cookie_name) !== -1) {\n      var cookieRegex = new RegExp(cookie_name + '\\=([^;]*)');\n      var cookie = Misago.get(document.cookie.match(cookieRegex), 0);\n      return cookie.split('=')[1];\n    } else {\n      return null;\n    }\n  };\n\n  var Ajax = function(_) {\n    this.refreshCsrfToken = function() {\n      this.csrfToken = getCsrfToken(_.context.CSRF_COOKIE_NAME);\n    };\n    this.refreshCsrfToken();\n\n    /*\n      List of GETs underway\n      We are limiting number of GETs to API to 1 per url\n    */\n    var runningGets = {};\n\n    this.ajax = function(method, url, data, progress) {\n      var promise = m.deferred();\n\n      var ajax_settings = {\n        url: url,\n        method: method,\n        headers: {\n          'X-CSRFToken': this.csrfToken\n        },\n\n        data: data || {},\n        dataType: 'json',\n\n        success: function(data) {\n          if (method === 'GET') {\n            Misago.pop(runningGets, url);\n          }\n          promise.resolve(data);\n        },\n        error: function(jqXHR) {\n          if (method === 'GET') {\n            Misago.pop(runningGets, url);\n          }\n\n          var rejection = jqXHR.responseJSON || {};\n\n          rejection.status = jqXHR.status;\n          rejection.statusText = jqXHR.statusText;\n\n          promise.reject(rejection);\n        }\n      };\n\n      if (progress) {\n        return; // not implemented... yet!\n      }\n\n      $.ajax(ajax_settings);\n      return promise.promise;\n    };\n\n    this.get = function(url) {\n      var preloaded = Misago.pop(_.context, url);\n      if (preloaded) {\n        var deferred = m.deferred();\n        deferred.resolve(preloaded);\n        return deferred.promise;\n      } else if (runningGets[url] !== undefined) {\n        return runningGets[url];\n      } else {\n        runningGets[url] = this.ajax('GET', url);\n        return runningGets[url];\n      }\n    };\n\n    this.post = function(url, data) {\n      return this.ajax('POST', url, data);\n    };\n\n    this.patch = function(url, data) {\n      return this.ajax('PATCH', url, data);\n    };\n\n    this.put = function(url, data) {\n      return this.ajax('PUT', url, data);\n    };\n\n    this.delete = function(url) {\n      return this.ajax('DELETE', url);\n    };\n  };\n\n  Misago.addService('ajax', function(_) {\n    return new Ajax(_);\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var ALERT_BASE_DISPLAY_TIME = 5 * 1000;\n  var ALERT_LENGTH_FACTOR = 70;\n  var ALERT_MAX_DISPLAY_TIME = 9 * 1000;\n  var ALERT_HIDE_ANIMATION_LENGTH = 300;\n\n  var Alert = function(_) {\n    var self = this;\n\n    this.type = 'info';\n    this.message = null;\n    this.isVisible = false;\n\n    var show = function(type, message) {\n      self.type = type;\n      self.message = message;\n      self.isVisible = true;\n\n      var displayTime = ALERT_BASE_DISPLAY_TIME;\n      displayTime += message.length * ALERT_LENGTH_FACTOR;\n      if (displayTime > ALERT_MAX_DISPLAY_TIME) {\n        displayTime = ALERT_MAX_DISPLAY_TIME;\n      }\n\n      _.runloop.runOnce(function () {\n        m.startComputation();\n        self.isVisible = false;\n        m.endComputation();\n      }, 'flash-message-hide', displayTime);\n    };\n\n    var set = function(type, message) {\n      _.runloop.stop('flash-message-hide');\n      _.runloop.stop('flash-message-show');\n\n      if (self.isVisible) {\n        self.isVisible = false;\n        _.runloop.runOnce(function () {\n          m.startComputation();\n          show(type, message);\n          m.endComputation();\n        }, 'flash-message-show', ALERT_HIDE_ANIMATION_LENGTH);\n      } else {\n        show(type, message);\n      }\n    };\n\n    this.info = function(message) {\n      set('info', message);\n    };\n\n    this.success = function(message) {\n      set('success', message);\n    };\n\n    this.warning = function(message) {\n      set('warning', message);\n    };\n\n    this.error = function(message) {\n      set('error', message);\n    };\n  };\n\n  Misago.addService('alert', {\n    factory: function(_) {\n      return new Alert(_);\n    }\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var filtersUrl = function(filters) {\n    if (typeof filters === 'object') {\n      var values = [];\n      for (var key in filters) {\n        if (filters.hasOwnProperty(key)) {\n          var encodedKey = encodeURIComponent(key);\n          var encodedValue = encodeURIComponent(filters[key]);\n          values.push(encodedKey + '=' + encodedValue);\n        }\n      }\n      return '?' + values.join('&');\n    } else {\n      return filters + '/';\n    }\n  };\n\n  var Query = function(_, call) {\n    this.url = call.url || _.setup.api;\n\n    if (call.path) {\n      this.url += call.path + '/';\n    } else if (call.related) {\n      this.url += call.related + '/';\n    } else {\n      this.url += call.model + 's' + '/';\n    }\n\n    if (call.filters) {\n      this.url += filtersUrl(call.filters);\n    }\n\n    if (!call.url && call.filters) {\n      if (call.model) {\n        this.related = function(model, filters) {\n          return new Query(_, {\n            url: this.url,\n            relation: call.model,\n            related: model,\n            filters: filters,\n          });\n        };\n      }\n\n      this.endpoint = function(path, filters) {\n        return new Query(_, {\n          url: this.url,\n          path: path,\n          filters: filters\n        });\n      };\n    }\n\n    this.get = function() {\n      var model = null;\n      if (call.related) {\n        model = call.relation + ':' + call.related;\n      } else if (call.model) {\n        model = call.model;\n      }\n\n      return _.ajax.get(this.url).then(function(data) {\n        if (model) {\n          if (data.results) {\n            data.results.map(function(item) {\n              return _.models.new(model, item);\n            });\n            return data;\n          } else {\n            return _.models.new(model, data);\n          }\n        } else {\n          return data;\n        }\n      });\n    };\n\n    this.post = function(data) {\n      return _.ajax.post(this.url, data);\n    };\n\n    this.patch = function(data) {\n      return _.ajax.patch(this.url, data);\n    };\n\n    this.put = function(data) {\n      return _.ajax.put(this.url, data);\n    };\n\n    this.delete = function() {\n      return _.ajax.delete(this.url);\n    };\n\n    // shortcut for get()\n    this.then = function(resolve, reject) {\n      return this.get().then(resolve, reject);\n    };\n  };\n\n  var Api = function(_) {\n    this.model = function(model, filters) {\n      return new Query(_, {\n        model: model,\n        filters: filters,\n      });\n    };\n\n    this.endpoint = function(path, filters) {\n      return new Query(_, {\n        path: path,\n        filters: filters\n      });\n    };\n\n    this.alert = function(rejection) {\n      // Shorthand for API errors\n      var message = gettext(\"Unknown error has occured.\");\n\n      if (rejection.status === 0) {\n        message = gettext(\"Lost connection with application.\");\n      }\n\n      if (rejection.status === 403) {\n        message = rejection.detail;\n        if (message === \"Permission denied\") {\n          message = gettext(\n            \"You don't have permission to perform this action.\");\n        }\n      }\n\n      if (rejection.status === 404) {\n        message = gettext(\"Action link is invalid.\");\n      }\n\n      _.alert.error(message);\n    };\n  };\n\n  Misago.addService('api', function(_) {\n    return new Api(_);\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var Auth = function(_) {\n    _.user = _.models.deserialize('user', _.context.user);\n  };\n\n  Misago.addService('auth', function(_) {\n    return new Auth(_);\n  },\n  {\n    after: 'model:user'\n  });\n}(Misago.prototype));\n\n/* global grecaptcha */\n(function (Misago) {\n  'use strict';\n\n  var NoCaptcha = function() {\n    var deferred = m.deferred();\n    deferred.resolve();\n\n    this.load = function() {\n      return deferred.promise;\n    };\n\n    this.value = function() {\n      return null;\n    };\n  };\n\n  var QACaptcha = function(_) {\n    var self = this;\n\n    this.loading = false;\n    this.question = null;\n    this.value = m.prop('');\n\n    var deferred = m.deferred();\n    this.load = function() {\n      this.value('');\n\n      if (!this.question && !this.loading) {\n        this.loading = true;\n\n        _.api.endpoint('captcha-question').get().then(function(question) {\n          self.question = question;\n          deferred.resolve();\n        }, function() {\n          _.api.alert(gettext('Failed to load CAPTCHA.'));\n          deferred.reject();\n        }).then(function() {\n          self.loading = true;\n        });\n      }\n\n      return deferred.promise;\n    };\n\n    this.component = function(kwargs) {\n      return _.component('form-group', {\n        label: this.question.question,\n        labelClass: kwargs.labelClass || null,\n        controlClass: kwargs.controlClass || null,\n        control: _.input({\n          value: _.validate(kwargs.form, 'captcha'),\n          id: 'id_captcha',\n          disabled: kwargs.form.isBusy\n        }),\n        validation: kwargs.form.errors,\n        validationKey: 'captcha',\n        helpText: this.question.help_text\n      });\n    };\n\n    this.validator = function() {\n      return [];\n    };\n  };\n\n  var ReCaptcha = function(_) {\n    this.included = false;\n    this.question = null;\n\n    var deferred = m.deferred();\n\n    var wait = function(promise) {\n      if (typeof grecaptcha !== \"undefined\") {\n        promise.resolve();\n      } else {\n        _.runloop.runOnce(function() {\n          wait(promise);\n        }, 'loading-grecaptcha', 150);\n      }\n    };\n\n    this.load = function() {\n      if (typeof grecaptcha !== \"undefined\") {\n        grecaptcha.reset();\n      }\n\n      if (!this.included) {\n        _.include('https://www.google.com/recaptcha/api.js', true);\n        this.included = true;\n      }\n\n      wait(deferred);\n\n      return deferred.promise;\n    };\n\n    var controlConfig = function(el, isInit, context) {\n      context.retain = true;\n\n      if (!isInit) {\n        grecaptcha.render('recaptcha', {\n          'sitekey': _.settings.recaptcha_site_key\n        });\n      }\n    };\n\n    this.component = function(kwargs) {\n      var control = m('#recaptcha', {\n        config: controlConfig\n      });\n\n      return _.component('form-group', {\n        label: gettext(\"Security test\"),\n        labelClass: kwargs.labelClass || null,\n        controlClass: kwargs.controlClass || null,\n        control: control,\n        validation: kwargs.form.errors,\n        validationKey: 'captcha'\n      });\n    };\n\n    this.value = function() {\n      if (typeof grecaptcha !== \"undefined\") {\n        return grecaptcha.getResponse();\n      } else {\n        return '';\n      }\n    };\n\n    this.clean = function(form) {\n      if (!this.value()) {\n        form.errors.captcha = [\n          gettext('This field is required.')\n        ];\n      } else {\n        form.errors.captcha = true;\n      }\n    };\n\n    this.validator = function() {\n      return [];\n    };\n  };\n\n  var Captcha = function(_) {\n    var types = {\n      'no': NoCaptcha,\n      'qa': QACaptcha,\n      're': ReCaptcha\n    };\n\n    var captcha = new types[_.settings.captcha_type](_);\n\n    this.value = captcha.value;\n\n    this.load = function() {\n      return captcha.load();\n    };\n\n    this.component = function(kwargs) {\n      if (captcha.component) {\n        return captcha.component(kwargs);\n      } else {\n        return null;\n      }\n    };\n\n    this.validator = function() {\n      if (captcha.validator) {\n        return captcha.validator();\n      } else {\n        return null;\n      }\n    };\n\n    this.clean = function(form) {\n      if (captcha.clean) {\n        captcha.clean(form);\n      } else {\n        form.errors.captcha = true;\n      }\n    };\n  };\n\n  Misago.addService('captcha', function(_) {\n    return new Captcha(_);\n  },\n  {\n    after: 'include'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var component = function(name, component) {\n    if (this._components[name]) {\n      if (arguments.length > 1) {\n        var argumentsArray = [this._components[name]];\n        for (var i = 1; i < arguments.length; i += 1) {\n          argumentsArray.push(arguments[i]);\n        }\n        argumentsArray.push(this);\n        return m.component.apply(undefined, argumentsArray);\n      } else {\n        return m.component(this._components[name], this);\n      }\n    } else {\n      this._components[name] = component;\n    }\n  };\n\n  Misago.addService('components', function(_) {\n    _._components = {};\n    _.component = component;\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.addService('conf', function(_) {\n    _.settings = Misago.get(_.context, 'SETTINGS', {});\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var boilerplate = function(form) {\n    var _submit = form.submit;\n    var _success = form.success;\n    var _error = form.error;\n\n    form.isBusy = false;\n\n    form.errors = null;\n\n    form.submit = function() {\n      if (form.isBusy) {\n        return false;\n      }\n\n      if (form.clean) {\n        if (form.clean()) {\n          form.isBusy = true;\n          _submit.apply(form);\n        }\n      } else {\n        form.isBusy = true;\n      }\n      return false;\n    };\n\n    form.success = function() {\n      m.startComputation();\n\n      _success.apply(form, arguments);\n      form.isBusy = false;\n\n      m.endComputation();\n    };\n\n    form.error = function() {\n      m.startComputation();\n\n      _error.apply(form, arguments);\n      form.isBusy = false;\n\n      m.endComputation();\n    };\n\n    form.hasErrors = function() {\n      if (form.errors === null) {\n        return false;\n      }\n\n      for (var key in form.validation) {\n        if (form.validation.hasOwnProperty(key)) {\n          if (form.errors[key] !== true) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    };\n\n    return form;\n  };\n\n  var form = function(name, constructor) {\n    if (this._forms[name]) {\n      if (constructor) {\n        return boilerplate(new this._forms[name](constructor, this));\n      } else {\n        return boilerplate(new this._forms[name](this));\n      }\n    } else {\n      this._forms[name] = constructor;\n    }\n  };\n\n  Misago.addService('forms', function(_) {\n    _._forms = {};\n    _.form = form;\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.addService('forum-layout', {\n    factory: function(_) {\n      if (_.setup.fixture) {\n        m.mount(document.getElementById(_.setup.fixture),\n                _.component('forum-layout'));\n      }\n    },\n\n    destroy: function(_) {\n      if (_.setup.fixture) {\n        m.mount(document.getElementById(_.setup.fixture), null);\n      }\n    }\n  },\n  {\n    before: 'start-routing'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var include = function(script, remote) {\n    if (!remote) {\n      script = this.context.STATIC_URL + script;\n    }\n\n    $.ajax({\n      url: script,\n      cache: true,\n      dataType: 'script'\n    });\n  };\n\n  Misago.addService('include', function(_) {\n    _.include = include;\n  },\n  {\n    after: 'conf'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var Modal = function() {\n    var self = this;\n\n    var element = document.getElementById('misago-modal');\n\n    // href clicks within modal should close it\n    var delegateName = 'click.misago-modal';\n    $(element).on(delegateName, 'a', function() {\n      self.hide();\n    });\n\n    this.destroy = function() {\n      $(element).off();\n      $('body').removeClass('modal-open');\n      $('.modal-backdrop').remove();\n    };\n\n    // Open/close modal\n    var modal = $(element).modal({show: false});\n    this.open = false;\n\n    modal.on('hidden.bs.modal', function () {\n      if (self.open) {\n        m.mount(element, null);\n        this.open = false;\n      }\n    });\n\n    this.show = function(component) {\n      this.open = true;\n      m.mount(element, component);\n      modal.modal('show');\n    };\n\n    this.hide = function() {\n      modal.modal('hide');\n    };\n  };\n\n  Misago.addService('_modal', {\n    factory: function() {\n      return new Modal();\n    },\n    destroy: function(_) {\n      _._modal.destroy();\n    }\n  },\n  {\n    after: 'start-routing'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var modal = function(name, component) {\n    if (this._modals[name]) {\n      var argumentsArray = [this._modals[name]];\n      for (var i = 1; i < arguments.length; i += 1) {\n        argumentsArray.push(arguments[i]);\n      }\n      argumentsArray.push(this);\n      this._modal.show(m.component.apply(m, argumentsArray));\n    } else if (name) {\n      this._modals[name] = component;\n    } else {\n      this._modal.hide();\n    }\n  };\n\n  Misago.addService('modals', function(_) {\n    _._modals = {};\n    _.modal = modal;\n  },\n  {\n    after: '_modal'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var Models = function() {\n    this.classes = {};\n    this.deserializers = {};\n    this.relations = {};\n\n    this.add = function(name, kwargs) {\n      if (kwargs.class) {\n        this.classes[name] = kwargs.class;\n      }\n\n      if (kwargs.deserialize) {\n        this.deserializers[name] = kwargs.deserialize;\n      }\n\n      if (kwargs.relations) {\n        for (var key in kwargs.relations) {\n          if (kwargs.relations.hasOwnProperty(key)) {\n            this.relations[name + ':' + key] = kwargs.relations[key];\n          }\n        }\n      }\n    };\n\n    this.new = function(name, data) {\n      if (this.classes[name]) {\n        return new this.classes[name](data);\n      } else {\n        return data;\n      }\n    };\n\n    this.deserialize = function(name, json) {\n      if (this.relations[name]) {\n        name = this.relations[name];\n      }\n\n      if (this.deserializers[name]) {\n        return this.new(name, this.deserializers[name](json, this));\n      } else {\n        return this.new(name, json);\n      }\n    };\n  };\n\n  Misago.addService('models', function() {\n    return new Models();\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.addService('set-momentjs-locale', function() {\n    moment.locale($('html').attr('lang'));\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var Router = function(_) {\n    var self = this;\n    this.baseUrl = $('base').attr('href');\n\n    var staticUrl = Misago.get(_.context, 'STATIC_URL', '/');\n    var mediaUrl = Misago.get(_.context, 'MEDIA_URL', '/');\n\n    // Routing\n    this.urls = {};\n    this.reverses = {};\n\n    var populatePatterns = function(urlconf) {\n      urlconf.patterns().forEach(function(url) {\n        var finalPattern = self.baseUrl + url.pattern;\n        finalPattern = finalPattern.replace('//', '/');\n\n        self.urls[finalPattern] = _.route(url.component);\n        self.reverses[url.name] = finalPattern;\n      });\n    };\n\n    this.startRouting = function(urlconf, fixture) {\n      populatePatterns(urlconf);\n      this.fixture = fixture;\n\n      if (_.setup.test) {\n        m.route.mode = 'search';\n      } else {\n        m.route.mode = 'pathname';\n      }\n      m.route(fixture, '/', this.urls);\n    };\n\n    this.url = function(name) {\n      return this.reverses[name];\n    };\n\n    // Delegate clicks\n    this.delegateElement = null;\n\n    this.cleanUrl = function(url) {\n      if (!url) { return; }\n\n      // Is link relative?\n      var isRelative = url.substr(0, 1) === '/' && url.substr(0, 2) !== '//';\n\n      // If link contains host, validate to see if its outgoing\n      if (!isRelative) {\n        var location = window.location;\n\n        // If protocol matches current one, strip it from string\n        // otherwhise stop handler\n        if (url.substr(0, 2) !== '//') {\n          var protocol = url.substr(0, location.protocol.length + 2);\n          if (protocol !== location.protocol + '//') { return; }\n          url = url.substr(location.protocol.length + 2);\n        } else {\n          url = url.substr(2);\n        }\n\n        // Host checks out?\n        if (url.substr(0, location.host.length) !== location.host) { return; }\n        url = url.substr(location.host.length);\n      }\n\n      // Is link within Ember app?\n      if (url.substr(0, this.baseUrl.length) !== this.baseUrl) { return; }\n\n      // Is link to media/static/avatar server?\n      if (url.substr(0, staticUrl.length) === staticUrl) { return; }\n\n      if (url.substr(0, mediaUrl.length) === mediaUrl) { return; }\n\n      var avatarsUrl = '/user-avatar/';\n      if (url.substr(0, avatarsUrl.length) === avatarsUrl) { return; }\n\n      return url;\n    };\n\n    var delegateName = 'click.misago-router';\n    this.delegateClicks = function(element) {\n      this.delegateElement = element;\n      $(this.delegateElement).on(delegateName, 'a', function(e) {\n        var cleanUrl = self.cleanUrl(e.target.href);\n        if (cleanUrl) {\n          if (cleanUrl != m.route()) {\n            m.route(cleanUrl);\n          }\n          e.preventDefault();\n        }\n      });\n    };\n\n    this.destroy = function() {\n      $(this.delegateElement).off(delegateName);\n    };\n\n    // Media/Static url\n    var prefixUrl = function(prefix) {\n      return function(url) {\n        return prefix + url;\n      };\n    };\n\n    this.staticUrl = prefixUrl(staticUrl);\n    this.mediaUrl = prefixUrl(mediaUrl);\n\n    // Errors\n    this.error403 = function(error) {\n      var component = null;\n      if (error.ban) {\n        component = _.route('error:banned',\n          error.detail,\n          _.models.deserialize('ban', error.ban));\n      } else {\n        component = _.route('error:403', error.detail);\n      }\n      m.mount(this.fixture, component);\n    };\n\n    this.error404 = function() {\n      m.mount(this.fixture, _.route('error:404'));\n    };\n\n    this.error500 = function() {\n      m.mount(this.fixture, _.route('error:500'));\n    };\n\n    this.error0 = function() {\n      m.mount(this.fixture, _.route('error:0'));\n    };\n\n    this.errorPage = function(error) {\n      if (error.status === 0) {\n        this.error0();\n      }\n\n      if (error.status === 500) {\n        this.error500();\n      }\n\n      if (error.status === 404) {\n        this.error404();\n      }\n\n      if (error.status === 403) {\n        this.error403(error);\n      }\n    };\n  };\n\n  Misago.addService('router', function(_) {\n    return new Router(_);\n  });\n\n  Misago.addService('start-routing', function(_) {\n    _.router.startRouting(\n      Misago.urls, document.getElementById('router-fixture'));\n    _.router.delegateClicks(document.getElementById(_.setup.fixture));\n  },\n  {\n    before: '_end'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var boilerplate = function(component) {\n    // Component already boilerplated (this may happen in tests)\n    if (component._hasRouteBoilerplate) {\n      return component;\n    }\n    component._hasRouteBoilerplate = true;\n\n    // Add lifecycle hooks\n    var loadingView = function () {\n      var _ = this.container;\n      return m('.page.page-loading',\n        _.component('loader')\n      );\n    };\n\n    var errorHandler = function(error) {\n      if (this.isActive) {\n        this.container.router.errorPage(error);\n      }\n    };\n\n    return Misago.stateHooks(component, loadingView, errorHandler);\n  };\n\n  Misago.addService('routes', function(_) {\n    _._routes = {};\n    _.route = function(name, component) {\n      if (this._routes[name]) {\n        if (arguments.length > 1) {\n          var argumentsArray = [this._routes[name]];\n          for (var i = 1; i < arguments.length; i += 1) {\n            argumentsArray.push(arguments[i]);\n          }\n          argumentsArray.push(this);\n          return m.component.apply(undefined, argumentsArray);\n        } else {\n          return m.component(this._routes[name], this);\n        }\n      } else {\n        component.container = _;\n        this._routes[name] = boilerplate(component);\n      }\n    };\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var RunLoop = function(_) {\n    var self = this;\n\n    this._intervals = {};\n\n    var stopInterval = function(name) {\n      if (self._intervals[name]) {\n        window.clearTimeout(self._intervals[name]);\n        self._intervals[name] = null;\n      }\n    };\n\n    this.run = function(callable, name, delay) {\n      this._intervals[name] = window.setTimeout(function() {\n        stopInterval(name);\n        var result = callable(_);\n        if (result !== false) {\n          self.run(callable, name, delay);\n        }\n      }, delay);\n    };\n\n    this.runOnce = function(callable, name, delay) {\n      this._intervals[name] = window.setTimeout(function() {\n        stopInterval(name);\n        callable(_);\n      }, delay);\n    };\n\n    this.stop = function(name) {\n      for (var loop in this._intervals) {\n        if (!name || name === loop) {\n          stopInterval(loop);\n        }\n      }\n    };\n  };\n\n  Misago.addService('runloop', {\n    factory: function(_) {\n      return new RunLoop(_);\n    },\n\n    destroy: function(_) {\n      _.runloop.stop();\n    }\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  Misago.addService('start-tick', function(_) {\n    var ticks = m.prop();\n\n    _.runloop.run(function() {\n      m.startComputation();\n      // just tick once a minute so stuff gets rerendered\n      ticks(ticks() + 1);\n      // syncing dynamic timestamps, etc ect\n      m.endComputation();\n    }, 'tick', 60000);\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var PageTitle = function(forum_name) {\n    this.set = function(title) {\n      if (title) {\n        this._set_complex(title);\n      } else {\n        document.title = forum_name;\n      }\n    };\n\n    this._set_complex = function(title) {\n      if (typeof title === 'string') {\n        title = {title: title};\n      }\n\n      var completeTitle = title.title;\n\n      if (typeof title.page !== 'undefined' && title.page > 1) {\n        var page_label = interpolate(\n          gettext('page %(page)s'), { page:title.page }, true);\n        completeTitle += ' (' + page_label + ')';\n      }\n\n      if (typeof title.parent !== 'undefined') {\n        completeTitle += ' | ' + title.parent;\n      }\n\n      document.title = completeTitle + ' | ' + forum_name;\n    };\n  };\n\n  Misago.addService('page-title', function(_) {\n    _.title = new PageTitle(_.settings.forum_name);\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var EMAIL = /^([\\w-]+(?:\\.[\\w-]+)*)@((?:[\\w-]+\\.)*\\w[\\w-]{0,66})\\.([a-z]{2,6}(?:\\.[a-z]{2})?)$/i;\n  var USERNAME = new RegExp('^[0-9a-z]+$', 'i');\n\n  // Validators namespace\n  Misago.validators = {\n    required: function() {\n      return function(value) {\n        if ($.trim(value).length === 0) {\n          return gettext(\"This field is required.\");\n        }\n      };\n    },\n    email: function(message) {\n      return function(value) {\n        if (!EMAIL.test(value)) {\n          return message || gettext('Enter a valid email address.');\n        }\n      };\n    },\n    minLength: function(limit_value, message) {\n      return function(value) {\n        var returnMessage = '';\n        var length = $.trim(value).length;\n\n        if (length < limit_value) {\n          if (message) {\n            returnMessage = message(limit_value, length);\n          } else {\n            returnMessage = ngettext(\n              \"Ensure this value has at least %(limit_value)d character (it has %(show_value)d).\",\n              \"Ensure this value has at least %(limit_value)d characters (it has %(show_value)d).\",\n              limit_value);\n          }\n          return interpolate(returnMessage, {\n            limit_value: limit_value,\n            show_value: length\n          }, true);\n        }\n      };\n    },\n    maxLength: function(limit_value, message) {\n      return function(value) {\n        var returnMessage = '';\n        var length = $.trim(value).length;\n\n        if (length > limit_value) {\n          if (message) {\n            returnMessage = message(limit_value, length);\n          } else {\n            returnMessage = ngettext(\n              \"Ensure this value has at most %(limit_value)d character (it has %(show_value)d).\",\n              \"Ensure this value has at most %(limit_value)d characters (it has %(show_value)d).\",\n              limit_value);\n          }\n          return interpolate(returnMessage, {\n            limit_value: limit_value,\n            show_value: length\n          }, true);\n        }\n      };\n    },\n    usernameMinLength: function(settings) {\n      var message = function(limit_value) {\n        return ngettext(\n          \"Username must be at least %(limit_value)s character long.\",\n          \"Username must be at least %(limit_value)s characters long.\",\n          limit_value);\n      };\n      return this.minLength(settings.username_length_min, message);\n    },\n    usernameMaxLength: function(settings) {\n      var message = function(limit_value) {\n        return ngettext(\n          \"Username cannot be longer than %(limit_value)s characters.\",\n          \"Username cannot be longer than %(limit_value)s characters.\",\n          limit_value);\n      };\n      return this.maxLength(settings.username_length_max, message);\n    },\n    usernameContent: function() {\n      return function(value) {\n        if (!USERNAME.test($.trim(value))) {\n          return gettext(\"Username can only contain latin alphabet letters and digits.\");\n        }\n      };\n    },\n    passwordMinLenght: function(settings) {\n      var message = function(limit_value) {\n        return ngettext(\n          \"Valid password must be at least %(limit_value)s character long.\",\n          \"Valid password must be at least %(limit_value)s characters long.\",\n          limit_value);\n      };\n      return this.minLength(settings.password_length_min, message);\n    }\n  };\n\n  var validateField = function(value, validators) {\n    var result = Misago.validators.required()(value);\n    var errors = [];\n\n    if (result) {\n      return [result];\n    } else {\n      for (var i in validators) {\n        result = validators[i](value);\n\n        if (result) {\n          errors.push(result);\n        }\n      }\n    }\n\n    return errors.length ? errors : true;\n  };\n\n  var validateForm = function(form) {\n    var errors = {};\n    var value = null;\n\n    var isValid = true;\n\n    for (var key in form.validation) {\n      if (form.validation.hasOwnProperty(key)) {\n        value = form[key]();\n        errors[key] = validateField(form[key](), form.validation[key]);\n        if (errors[key] !== true) {\n          isValid = false;\n        }\n      }\n    }\n\n    form.errors = errors;\n    return isValid;\n  };\n\n  var validate = function(form, name) {\n    if (name) {\n      return function(value) {\n        var errors = null;\n        if (typeof value !== 'undefined') {\n          errors = validateField(value, form.validation[name]);\n          if (errors) {\n            if (!form.errors) {\n              form.errors = {};\n            }\n            form.errors[name] = errors;\n          }\n          form[name](value);\n          return form[name](value);\n        } else {\n          return form[name]();\n        }\n      };\n    } else {\n      return validateForm(form);\n    }\n  };\n\n  Misago.addService('validate', {\n    factory: function() {\n      return validate;\n    }\n  });\n}(Misago.prototype));\n\n/* global zxcvbn */\n(function (Misago) {\n  'use strict';\n\n  var Zxcvbn = function(_) {\n    this.included = false;\n\n    this.scorePassword = function(password, inputs) {\n      // 0-4 score, the more the stronger password\n      return zxcvbn(password, inputs).score;\n    };\n\n    // loading\n    this.include = function() {\n      _.include('misago/js/zxcvbn.js');\n      this.included = true;\n    };\n\n    var wait = function(promise) {\n      if (typeof zxcvbn !== \"undefined\") {\n        promise.resolve();\n      } else {\n        _.runloop.runOnce(function() {\n          wait(promise);\n        }, 'loading-zxcvbn', 150);\n      }\n    };\n\n    var deferred = m.deferred();\n    this.load = function() {\n      if (!this.included) {\n        this.include();\n      }\n      wait(deferred);\n      return deferred.promise;\n    };\n  };\n\n  Misago.addService('zxcvbn', function(_) {\n    return new Zxcvbn(_);\n  },\n  {\n    after: 'include'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var Ban = function(data) {\n    this.message = {\n      html: data.message.html,\n      plain: data.message.plain,\n    };\n\n    this.expires_on = data.expires_on;\n  };\n\n  var deserializeBan = function(data) {\n    data.expires_on = Misago.deserializeDatetime(data.expires_on);\n\n    return data;\n  };\n\n  Misago.addService('model:ban', function(_) {\n    _.models.add('ban', {\n      class: Ban,\n      deserialize: deserializeBan\n    });\n  },\n  {\n    after: 'models'\n  });\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var LegalPage = function(data) {\n    this.title = data.title;\n    this.body = data.body;\n    this.link = data.link;\n  };\n\n  Misago.addService('model:legal-page', function(_) {\n    _.models.add('legal-page', {\n      class: LegalPage\n    });\n  },\n  {\n    after: 'models'\n  });\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var User = function(data) {\n    this.id = data.id;\n\n    this.isAuthenticated = !!this.id;\n    this.isAnonymous = !this.isAuthenticated;\n\n    this.slug = data.slug;\n    this.username = data.username;\n\n    this.acl = data.acl;\n    this.rank = data.rank;\n  };\n\n  var deserializeUser = function(data) {\n    if (data.joined_on) {\n      data.joined_on = Misago.deserializeDatetime(data.joined_on);\n    }\n\n    return data;\n  };\n\n  Misago.addService('model:user', function(_) {\n    _.models.add('user', {\n      class: User,\n      deserialize: deserializeUser\n    });\n  },\n  {\n    after: 'models'\n  });\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var errorPage = function(error) {\n    var error_message = [\n      m('p.lead', error.message)\n    ];\n\n    if (error.help) {\n      error_message.push(m('p.help', error.help));\n    }\n\n    return m('.page.page-error.page-error-' + error.code,\n      m('.container',\n        m('.error-panel', [\n          m('.error-icon',\n            m('span.material-icon', error.icon)\n          ),\n          m('.error-message', error_message)\n        ])\n      )\n    );\n  };\n\n  var errorBanned = {\n    controller: function() {\n      this.container.title.set(gettext('You are banned'));\n    },\n    view: function(ctrl, message, ban) {\n      var error_message = [];\n\n      if (ban.message.html) {\n        error_message.push(m('.lead', m.trust(ban.message.html)));\n      } else if (message) {\n        error_message.push(m('p.lead', message));\n      } else {\n        error_message.push(m('p.lead', gettext('You are banned.')));\n      }\n\n      var expirationMessage = null;\n      if (ban.expires_on) {\n        if (ban.expires_on.isAfter(moment())) {\n          expirationMessage = interpolate(\n            gettext('This ban expires %(expires_on)s.'),\n            {'expires_on': ban.expires_on.fromNow()},\n            true);\n        } else {\n          expirationMessage = gettext('This ban has expired.');\n        }\n      } else {\n        expirationMessage = gettext('This ban is permanent.');\n      }\n      error_message.push(m('p', expirationMessage));\n\n      return m('.page.page-error.page-error-banned',\n        m('.container',\n          m('.error-panel', [\n            m('.error-icon',\n              m('span.material-icon', 'highlight_off')\n            ),\n            m('.error-message', error_message)\n          ])\n        )\n      );\n    }\n  };\n\n  var error403 = {\n    controller: function() {\n      this.container.title.set(gettext('Page not available'));\n    },\n    view: function(ctrl, message) {\n      if (message === \"Permission denied\") {\n        message = gettext(\"You don't have permission to access this page.\");\n      }\n\n      return errorPage({\n        code: 403,\n        icon: 'remove_circle_outline',\n        message: gettext(\"This page is not available.\"),\n        help: message\n      });\n    }\n  };\n\n  var error404 = {\n    controller: function() {\n      this.container.title.set(gettext('Page not found'));\n    },\n    view: function() {\n      return errorPage({\n        code: 404,\n        icon: 'info_outline',\n        message: gettext(\"Requested page could not be found.\"),\n        help: gettext(\"The link you followed was incorrect or the page has been moved or deleted.\")\n      });\n    }\n  };\n\n  var error500 = {\n    controller: function() {\n      this.container.title.set(gettext('Application error occured'));\n    },\n    view: function() {\n      return errorPage({\n        code: 500,\n        icon: 'error_outline',\n        message: gettext(\"Requested page could not be displayed due to an error.\"),\n        help: gettext(\"Please try again later or contact site staff if error persists.\")\n      });\n    }\n  };\n\n  var error0 = {\n    controller: function() {\n      this.container.title.set(gettext('Lost connection with application'));\n    },\n    view: function() {\n      return errorPage({\n        code: 0,\n        icon: 'sync_problem',\n        message: gettext(\"Could not connect to application.\"),\n        help: gettext(\"This may be caused by problems with your connection or application server. Please check your internet connection and refresh page if problem persists.\")\n      });\n    }\n  };\n\n  Misago.addService('route:error-pages', function(_) {\n    _.route('error:banned', errorBanned);\n    _.route('error:403', error403);\n    _.route('error:404', error404);\n    _.route('error:500', error500);\n    _.route('error:0', error0);\n  },\n  {\n    after: 'routes'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var index = {\n    controller: function(_) {\n      document.title = _.settings.forum_index_title || _.settings.forum_name;\n\n      return {\n        active: function() {\n          _.modal('register-complete', {\n            'activation': 'active',\n            'username': 'BobBoberson',\n            'email': 'bob-boberson@somewhere.com'\n          });\n        },\n        user: function() {\n          _.modal('register-complete', {\n            'activation': 'by_user',\n            'username': 'BobBoberson',\n            'email': 'bob-boberson@somewhere.com'\n          });\n        },\n        admin: function() {\n          _.modal('register-complete', {\n            'activation': 'by_admin',\n            'username': 'BobBoberson',\n            'email': 'bob-boberson@somewhere.com'\n          });\n        }\n      };\n    },\n    view: function(ctrl, _) {\n      return m('.container', [\n        m('h1', 'Buttons'),\n        m('p', 'Test registration successful modal!'),\n        m('',\n          _.component('button', {\n            class: '.btn-success',\n            label: 'Registration done, account active',\n            onclick: ctrl.active\n          })\n        ),\n        m('',\n          _.component('button', {\n            class: '.btn-warning',\n            label: 'Registration done, account inactive (user)',\n            onclick: ctrl.user\n          })\n        ),\n        m('',\n          _.component('button', {\n            class: '.btn-danger',\n            label: 'Registration done, account inactive (admin)',\n            onclick: ctrl.admin\n          })\n        ),\n      ]);\n    }\n  };\n\n  Misago.addService('route:index', function(_) {\n    _.route('index', index);\n  },\n  {\n    after: 'routes'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var legalPageFactory = function(typeName, defaultTitle) {\n    var dashedTypeName = typeName.replace(/_/g, '-');\n\n    return {\n      controller: function(_) {\n        if (Misago.get(_.settings, typeName + '_link')) {\n          window.location = Misago.get(_.settings, typeName + '_link');\n        } else {\n          this.vm.init(this, _);\n        }\n      },\n      vm: {\n        page: null,\n        isReady: false,\n        init: function(component, _) {\n          if (this.isReady) {\n            _.title.set(this.title);\n          } else {\n            _.title.set();\n            return _.api.model('legal-page', dashedTypeName);\n          }\n        },\n        ondata: function(page, component, _) {\n          m.startComputation();\n\n          if (page.link) {\n            window.location = page.link;\n          } else {\n            page.title = page.title || defaultTitle;\n            this.page = page;\n            this.isReady = true;\n\n            m.endComputation();\n\n            if (component.isActive) {\n              _.title.set(this.page.title);\n            }\n          }\n        }\n      },\n      view: function(ctrl, _) {\n        return m('.page.page-legal.page-legal-' + dashedTypeName, [\n          _.component('header', {title: this.vm.page.title}),\n          m('.container',\n            _.component('markup', this.vm.page.body)\n          )\n        ]);\n      }\n    };\n  };\n\n  Misago.addService('route:legal-pages', function(_) {\n    _.route('terms-of-service', legalPageFactory(\n      'terms_of_service', gettext('Terms of service')));\n    _.route('privacy-policy', legalPageFactory(\n      'privacy_policy', gettext('Privacy policy')));\n  },\n  {\n    after: 'routes'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var isMenuVisible = function(settings) {\n    return [\n      !!settings.forum_footnote,\n      !!settings.terms_of_service,\n      !!settings.terms_of_service_link,\n      !!settings.privacy_policy,\n      !!settings.privacy_policy_link\n    ].indexOf(true) !== -1;\n  };\n\n  var footer = {\n    view: function(ctrl, _) {\n      var nav = null;\n      if (isMenuVisible(_.settings)) {\n        nav = _.component('footer:menu');\n      }\n\n      return m('footer.forum-footer', [\n        m('.container',\n          m('.footer-content', [\n            nav,\n            _.component('footer:branding')\n          ])\n        )\n      ]);\n    }\n  };\n\n  Misago.addService('component:footer', function(_) {\n    _.component('footer', footer);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var legalLink = function(_, legalType, defaultTitle) {\n    var url = Misago.get(_.settings, legalType + '_link');\n    if (!url && Misago.get(_.settings, legalType)) {\n      url = _.router.url(legalType);\n    }\n\n    if (url) {\n      return m('li',\n        m('a', {href: url},\n          Misago.get(_.settings, legalType + '_title', defaultTitle)\n        )\n      );\n    } else {\n      return null;\n    }\n  };\n\n  var menu = {\n    isVisible: function(settings) {\n      return [\n        !!settings.forum_footnote,\n        !!settings.terms_of_service,\n        !!settings.terms_of_service_link,\n        !!settings.privacy_policy,\n        !!settings.privacy_policy_link\n      ].indexOf(true) !== -1;\n    },\n    view: function(ctrl, _) {\n      var items = [];\n\n      if (_.settings.forum_footnote) {\n        items.push(m('li.forum-footnote', m.trust(_.settings.forum_footnote)));\n      }\n\n      items.push(\n        legalLink(_, 'terms_of_service', gettext('Terms of service')));\n      items.push(\n        legalLink(_, 'privacy_policy', gettext('Privacy policy')));\n\n      return m('ul.list-inline.footer-nav', items);\n    }\n  };\n\n  Misago.addService('component:footer:menu', function(_) {\n    _.component('footer:menu', menu);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var branding = {\n    view: function() {\n      return m('a.misago-branding[href=http://misago-project.org]', [\n        \"powered by \", m('strong', \"misago\")\n      ]);\n    }\n  };\n\n  Misago.addService('component:footer:branding', function(_) {\n    _.component('footer:branding', branding);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var header = {\n    view: function(ctrl, title) {\n      return m('.modal-header', [\n        m('button.close[type=\"button\"]',\n          {'data-dismiss': 'modal', 'aria-label': gettext('Close')},\n          m('span', {'aria-hidden': 'true'}, m.trust('&times;'))\n        ),\n        m('h4#misago-modal-label.modal-title', title)\n      ]);\n    }\n  };\n\n  Misago.addService('component:modal:header', function(_) {\n    _.component('modal:header', header);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var persistent = function(el, isInit, context) {\n    context.retain = true;\n  };\n\n  var refresh = function() {\n    document.location.reload();\n  };\n\n  var registerComplete = {\n    controller: function(message, _) {\n      if (message.activation === 'active') {\n        _.runloop.runOnce(\n          refresh, 'refresh-after-registration', 10000);\n      }\n    },\n    view: function(ctrl, message, _) {\n      var messageHtml = null;\n\n      if (message.activation === 'active') {\n        messageHtml = this.active(message);\n      } else {\n        messageHtml = this.inactive(message);\n      }\n\n      return m('.modal-dialog.modal-message.modal-register[role=\"document\"]',\n        {config: persistent},\n        m('.modal-content', [\n          _.component('modal:header', gettext('Registration complete')),\n          m('.modal-body',\n            messageHtml\n          )\n        ])\n      );\n    },\n    active: function(message) {\n      var lead = gettext(\"%(username)s, your account has been created and you were signed in.\");\n      return [\n        m('.message-icon',\n          m('span.material-icon', 'check')\n        ),\n        m('.message-body', [\n          m('p.lead',\n            interpolate(lead, {'username': message.username}, true)\n          ),\n          m('p',\n            gettext('The page will refresh automatically in 10 seconds.')\n          ),\n          m('p',\n            m('button[type=\"button\"].btn.btn-default', {onclick: refresh},\n              gettext('Refresh page')\n            )\n          )\n        ])\n      ];\n    },\n    inactive: function(message) {\n      var lead = null;\n      var help = null;\n\n      if (message.activation === 'by_user') {\n        lead = gettext(\"%(username)s, your account has been created but you need to activate it before you will be able to sign in.\");\n        help = gettext(\"We have sent an e-mail to %(email)s with link that you have to click to activate your account.\");\n      } else if (message.activation === 'by_admin') {\n        lead = gettext(\"%(username)s, your account has been created but board administrator will have to activate it before you will be able to sign in.\");\n        help = gettext(\"We will send an e-mail to %(email)s when this takes place.\");\n      }\n\n      return [\n        m('.message-icon',\n          m('span.material-icon', 'info_outline')\n        ),\n        m('.message-body', [\n          m('p.lead',\n            interpolate(lead, {'username': message.username}, true)\n          ),\n          m('p',\n            interpolate(help, {'email': message.email}, true)\n          )\n        ])\n      ];\n    }\n  };\n\n  Misago.addService('modal:register-complete', function(_) {\n    _.modal('register-complete', registerComplete);\n  },\n  {\n    after: 'modals'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var persistent = function(el, isInit, context) {\n    context.retain = true;\n  };\n\n  var register = {\n    controller: function(_) {\n      return {\n        form: _.form('register')\n      };\n    },\n    view: function(ctrl, _) {\n      var captcha = _.captcha.component({\n        form: ctrl.form,\n\n        labelClass: '.col-md-4',\n        controlClass: '.col-md-8'\n      });\n\n      var footnote = null;\n      var termsUrl = _.settings.terms_of_service_link;\n\n      if (!termsUrl && _.settings.terms_of_service) {\n        termsUrl = _.router.url('terms_of_service');\n      }\n\n      if (termsUrl) {\n        footnote = m('a', {href: termsUrl},\n          m.trust(interpolate(gettext(\"By registering you agree to site's %(terms)s.\"), {\n            terms: '<strong>' + gettext(\"terms and conditions\") + '</strong>'\n          }, true))\n        );\n      }\n\n      return m('.modal-dialog.modal-form.modal-register[role=\"document\"]',\n        {config: persistent},\n        m('.modal-content', [\n          _.component('modal:header', gettext('Register')),\n          m('form.form-horizontal',\n          {\n            onsubmit: ctrl.form.submit\n          },\n          [\n            m('input[type=\"text\"]', {\n              name:'_username',\n              style: 'display: none'\n            }),\n            m('input[type=\"password\"]', {\n              name:'_password',\n              style: 'display: none'\n            }),\n            m('.modal-body', [\n              _.component('form-group', {\n                label: gettext(\"Username\"),\n                labelClass: '.col-md-4',\n                controlClass: '.col-md-8',\n                control: _.input({\n                  value: _.validate(ctrl.form, 'username'),\n                  id: 'id_username',\n                  disabled: ctrl.form.isBusy\n                }),\n                validation: ctrl.form.errors,\n                validationKey: 'username'\n              }),\n              _.component('form-group', {\n                label: gettext(\"E-mail\"),\n                labelClass: '.col-md-4',\n                controlClass: '.col-md-8',\n                control: _.input({\n                  value: _.validate(ctrl.form, 'email'),\n                  id: 'id_email',\n                  disabled: ctrl.form.isBusy\n                }),\n                validation: ctrl.form.errors,\n                validationKey: 'email'\n              }),\n              _.component('form-group', {\n                label: gettext(\"Password\"),\n                labelClass: '.col-md-4',\n                controlClass: '.col-md-8',\n                control: _.input({\n                  value: _.validate(ctrl.form, 'password'),\n                  type: 'password',\n                  id: 'id_password',\n                  disabled: ctrl.form.isBusy\n                }),\n                validation: ctrl.form.errors,\n                validationKey: 'password',\n                helpText: _.component('password-strength', {\n                  inputs: [\n                    ctrl.form.username(),\n                    ctrl.form.email()\n                  ],\n                  password: ctrl.form.password()\n                })\n              }),\n              captcha\n            ]),\n            m('.modal-footer', [\n              footnote,\n              _.component('button', {\n                class: '.btn-primary',\n                submit: true,\n                loading: ctrl.form.isBusy,\n                label: gettext(\"Register account\")\n              })\n            ])\n          ])\n        ])\n      );\n    }\n  };\n\n  Misago.addService('modal:register', function(_) {\n    _.modal('register', register);\n  },\n  {\n    after: 'modals'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  function persistent(el, isInit, context) {\n    context.retain = true;\n  }\n\n  var signin = {\n    controller: function(_) {\n      return {\n        form: _.form('sign-in')\n      };\n    },\n    view: function(ctrl, _) {\n      return m('.modal-dialog.modal-sm.modal-signin[role=\"document\"]',\n        {config: persistent},\n        m('.modal-content', [\n          _.component('modal:header', gettext(\"Sign in\")),\n          m('form', {onsubmit: ctrl.form.submit}, [\n            m('.modal-body', [\n              m('.form-group',\n                m('.control-input',\n                  Misago.input({\n                    disabled: ctrl.form.isBusy,\n                    value: ctrl.form.username,\n                    placeholder: gettext(\"Username or e-mail\")\n                  })\n                )\n              ),\n              m('.form-group',\n                m('.control-input',\n                  Misago.input({\n                    type: 'password',\n                    disabled: ctrl.form.isBusy,\n                    value: ctrl.form.password,\n                    placeholder: gettext(\"Password\")\n                  })\n                )\n              )\n            ]),\n            m('.modal-footer',\n              _.component('button', {\n                class: '.btn-primary.btn-block',\n                submit: true,\n                loading: ctrl.form.isBusy,\n                label: gettext(\"Sign in\")\n              })\n            )\n          ])\n        ])\n      );\n    }\n  };\n\n  Misago.addService('modal:sign-in', function(_) {\n    _.modal('sign-in', signin);\n  },\n  {\n    after: 'modals'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var navbar = {\n    view: function(ctrl, _) {\n      var style = '.navbar.navbar-default.navbar-static-top';\n      return m('nav' + style + '[role=\"navigation\"]', [\n        _.component('navbar:desktop')\n      ]);\n    }\n  };\n\n  Misago.addService('component:navbar', function(_) {\n    _.component('navbar', navbar);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var brand = {\n    view: function(ctrl, branding, _) {\n      var children = [\n        m('img', {\n          src: _.router.staticUrl('misago/img/site-logo.png'),\n          alt: _.settings.forum_name\n        })\n      ];\n\n      if (branding) {\n        children.push(branding);\n      }\n\n      return m('a.navbar-brand', {href: _.router.url('index')}, children);\n    }\n  };\n\n  Misago.addService('component:navbar:desktop:brand', function(_) {\n    _.component('navbar:desktop:brand', brand);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var menu = {\n    controller: function(_) {\n      return {\n        showSignIn: function() {\n          _.modal('sign-in');\n        },\n\n        isBusy: false,\n        showRegister: function() {\n          if (_.settings.account_activation === 'closed') {\n            _.alert.info(gettext(\"New registrations are currently disabled.\"));\n          } else {\n            m.startComputation();\n            this.isBusy = true;\n            m.endComputation();\n\n            var self = this;\n            m.sync([\n              _.zxcvbn.load(),\n              _.captcha.load()\n            ]).then(function() {\n              _.modal('register');\n            }, function() {\n              _.alert.error(gettext('Registation is not available now due to an error.'));\n            }).then(function() {\n              m.startComputation();\n              self.isBusy = false;\n              m.endComputation();\n            });\n          }\n        }\n      };\n    },\n    view: function(ctrl, _) {\n      return m('div.nav.nav-guest', [\n        _.component('button', {\n          class: '.navbar-btn.btn-default',\n          onclick: ctrl.showSignIn,\n          disabled: ctrl.isBusy,\n          label: gettext('Sign in')\n        }),\n        _.component('button', {\n          class: '.navbar-btn.btn-primary',\n          onclick: ctrl.showRegister.bind(ctrl),\n          loading: ctrl.isBusy,\n          label: gettext('Register')\n        })\n      ]);\n    }\n  };\n\n  Misago.addService('component:navbar:desktop:guest-menu', function(_) {\n    _.component('navbar:desktop:guest-menu', menu);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var navbar = {\n    view: function(ctrl, _) {\n      var menu = [];\n\n      if (_.settings.forum_branding_display) {\n        menu.push(\n          _.component('navbar:desktop:brand', _.settings.forum_branding_text));\n      }\n\n      menu.push(m('ul.nav.navbar-nav', [\n        m('li',\n          m(\"a\", {config: m.route, href: _.router.url('index')}, 'Index')\n        )\n      ]));\n\n      if (_.user.isAuthenticated) {\n        menu.push(_.component('navbar:desktop:user-menu'));\n      } else {\n        menu.push(_.component('navbar:desktop:guest-menu'));\n      }\n\n      return m('.container.navbar-full.hidden-xs.hidden-sm', menu);\n    }\n  };\n\n  Misago.addService('component:navbar:desktop', function(_) {\n    _.component('navbar:desktop', navbar);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var menu = {\n    controller: function() {\n      return {\n        logout: function() {\n          $('#hidden-logout-form').submit();\n        }\n      };\n    },\n    view: function(ctrl, _) {\n      return m('div.nav.nav-user', [\n        m('p.navbar-text',\n          _.user.username\n        ),\n        m('button.navbar-btn.btn.btn-default.navbar-right',\n          {\n            onclick: ctrl.logout.bind(ctrl)\n          },\n          gettext(\"Logout\")\n        )\n      ]);\n    }\n  };\n\n  Misago.addService('component:navbar:desktop:user-menu', function(_) {\n    _.component('navbar:desktop:user-menu', menu);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  function persistent(el, isInit, context) {\n    context.retain = true;\n  }\n\n  var alert = {\n    classes: {\n      'info': 'alert-info',\n      'success': 'alert-success',\n      'warning': 'alert-warning',\n      'error': 'alert-danger'\n    },\n    view: function(ctrl, _) {\n      return m(\n        '.alerts',\n        {\n          config: persistent,\n          class: _.alert.isVisible ? 'in' : 'out'\n        },\n        m('p.alert',\n          {\n            class: this.classes[_.alert.type]\n          },\n          _.alert.message\n        )\n      );\n    }\n  };\n\n  Misago.addService('component:alert', function(_) {\n    _.component('alert', alert);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var button = {\n    view: function(ctrl, kwargs) {\n      var options = {\n        disabled: kwargs.disabled || kwargs.loading || false,\n        config: kwargs.config || null,\n        loading: kwargs.loading || false,\n        type: kwargs.submit ? 'submit' : 'button',\n        onclick: kwargs.onclick || null\n      };\n\n      var element = 'button[type=\"' + options.type + '\"].btn';\n      if (options.loading) {\n        element += '.btn-loading';\n      }\n\n      if (kwargs.id) {\n        element += '#' + kwargs.id;\n      }\n\n      element += (kwargs.class || '');\n\n      var label = kwargs.label;\n      if (options.loading) {\n        label = [\n          label,\n          m('.loader-compact', [\n            m('.bounce1'),\n            m('.bounce2'),\n            m('.bounce3')\n          ])\n        ];\n      }\n\n      return m(element, options, label);\n    },\n  };\n\n  Misago.addService('component:button', function(_) {\n    _.component('button', button);\n  },\n  {\n    after: 'components'\n  });\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var textFields = ['text', 'password', 'email'];\n\n  var formGroup = {\n    view: function(ctrl, kwargs) {\n      var groupClass = '.form-group';\n      var errors = null;\n      var helpText = null;\n\n      var controlType = kwargs.control.attrs.type;\n      var controlId = kwargs.control.attrs.id;\n\n      var feedbackId = controlId + '_feedback';\n      var feedbackIcon = null;\n      var showFeedbackIcon = null;\n\n      var isValidated = kwargs.validationKey && kwargs.validation !== null;\n\n      kwargs.control.attrs['aria-describedby'] = '';\n\n      if (isValidated && kwargs.validation[kwargs.validationKey]) {\n        showFeedbackIcon = textFields.indexOf(controlType) >= 0;\n        kwargs.control.attrs['aria-describedby'] = feedbackId;\n\n        if (kwargs.validation[kwargs.validationKey] === true) {\n          groupClass += '.has-success';\n          feedbackIcon = [\n            m('span.material-icon.form-control-feedback',\n              {\n                'aria-hidden': 'true'\n              },\n              'check'\n            ),\n            m('span.sr-only#' + feedbackId, gettext(\"(success)\"))\n          ];\n        } else {\n          groupClass += '.has-error';\n          errors = kwargs.validation[kwargs.validationKey];\n          feedbackIcon = [\n            m('span.material-icon.form-control-feedback',\n              {\n                'aria-hidden': 'true'\n              },\n              'clear'\n            ),\n            m('span.sr-only#' + feedbackId, gettext(\"(error)\"))\n          ];\n        }\n      }\n\n      if (kwargs.helpText) {\n        if (typeof kwargs.helpText === 'string' ||\n            kwargs.helpText instanceof String) {\n          helpText = m('p.help-block', kwargs.helpText);\n        } else {\n          helpText = kwargs.helpText;\n        }\n      }\n\n      return m(groupClass, [\n        m('label.control-label' + (kwargs.labelClass || ''),\n          {\n            for: kwargs.labelFor || controlId\n          },\n          kwargs.label + ':'\n        ),\n        m(kwargs.controlClass || '', [\n          kwargs.control,\n          showFeedbackIcon ? feedbackIcon : null,\n          errors ? m('.help-block.errors', errors.map(function(item) {\n            return m('p', item);\n          })) : null,\n          helpText\n        ])\n      ]);\n    },\n  };\n\n  Misago.addService('component:form-group', function(_) {\n    _.component('form-group', formGroup);\n  },\n  {\n    after: 'components'\n  });\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var persistent = function(el, isInit, context) {\n    context.retain = true;\n  };\n\n  var forumLayout = {\n    view: function(ctrl, _) {\n      return [\n        _.component('alert'),\n        _.component('navbar'),\n        m('#router-fixture', {config: persistent}),\n        _.component('footer'),\n        _.component('modal')\n      ];\n    }\n  };\n\n  Misago.addService('component:layout', function(_) {\n    _.component('forum-layout', forumLayout);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var loader = {\n    view: function() {\n      return m('.loader.sk-folding-cube', [\n        m('.sk-cube1.sk-cube'),\n        m('.sk-cube2.sk-cube'),\n        m('.sk-cube4.sk-cube'),\n        m('.sk-cube3.sk-cube')\n      ]);\n    }\n  };\n\n  Misago.addService('component:loader', function(_) {\n    _.component('loader', loader);\n  },\n  {\n    after: 'components'\n  });\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var persistent = function(el, isInit, context) {\n    context.retain = true;\n  };\n\n  var markup = {\n    view: function(ctrl, content) {\n      return m('article.misago-markup', {config: persistent},\n        m.trust(content)\n      );\n    }\n  };\n\n  Misago.addService('component:markup', function(_) {\n    _.component('markup', markup);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var persistent = function(el, isInit, context) {\n    context.retain = true;\n  };\n\n  var modal = {\n    view: function() {\n      return m(\n        '#misago-modal.modal.fade[role=\"dialog\"]',\n        {\n          config: persistent,\n          tabindex: \"-1\",\n          \"aria-labelledby\": \"misago-modal-label\"\n        }\n      );\n    }\n  };\n\n  Misago.addService('component:modal', function(_) {\n    _.component('modal', modal);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var header = {\n    view: function(ctrl, options) {\n      return m('.page-header',\n        m('.container', [\n          m('h1', options.title),\n        ])\n      );\n    }\n  };\n\n  Misago.addService('component:header', function(_) {\n    _.component('header', header);\n  },\n  {\n    after: 'components'\n  });\n}(Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var persistent = function(el, isInit, context) {\n    context.retain = true;\n  };\n\n  var styles = [\n    'progress-bar-danger',\n    'progress-bar-warning',\n    'progress-bar-warning',\n    'progress-bar-primary',\n    'progress-bar-success'\n  ];\n\n  var labels = [\n    gettext('Entered password is very weak.'),\n    gettext('Entered password is weak.'),\n    gettext('Entered password is average.'),\n    gettext('Entered password is strong.'),\n    gettext('Entered password is very strong.')\n  ];\n\n  var passwordStrength = {\n    view: function(ctrl, kwargs, _) {\n      var score = _.zxcvbn.scorePassword(kwargs.password, kwargs.inputs);\n      var options = {\n        config: persistent,\n        class: styles[score],\n        style: \"width: \" + (20 + (20 * score)) + '%',\n        'role': \"progressbar\",\n        'aria-valuenow': score,\n        'aria-valuemin': \"0\",\n        'aria-valuemax': \"4\"\n      };\n\n      return m('.help-block.password-strength', {key: 'password-strength'}, [\n        m('.progress',\n          m('.progress-bar', options,\n            m('span.sr-only', labels[score])\n          )\n        ),\n        m('p.text-small', labels[score])\n      ]);\n    },\n  };\n\n  Misago.addService('component:password-strength', function(_) {\n    _.component('password-strength', passwordStrength);\n  },\n  {\n    after: 'components'\n  });\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var Register = function(_) {\n    var self = this;\n\n    this.showActivation = false;\n\n    this.username = m.prop('');\n    this.email = m.prop('');\n    this.password = m.prop('');\n\n    this.captcha = _.captcha.value;\n\n    this.errors = null;\n\n    this.validation = {\n      'username': [\n        Misago.validators.usernameContent(),\n        Misago.validators.usernameMinLength(_.settings),\n        Misago.validators.usernameMaxLength(_.settings)\n      ],\n      'email': [\n        Misago.validators.email()\n      ],\n      'password': [\n        Misago.validators.passwordMinLenght(_.settings)\n      ],\n      'captcha': _.captcha.validator()\n    };\n\n    this.clean = function() {\n      if (this.errors === null) {\n        _.validate(this);\n      }\n\n      _.captcha.clean(this);\n\n      if (this.hasErrors()) {\n        _.alert.error(gettext(\"Form contains errors\"));\n        return false;\n      } else {\n        return true;\n      }\n    };\n\n    this.submit = function() {\n      _.api.model('user').post({\n        username: this.username(),\n        email: this.email(),\n        password: this.password(),\n        captcha: this.captcha()\n      }).then(this.success, this.error);\n    };\n\n    this.success = function(data) {\n      _.modal('register-complete', data);\n    };\n\n    this.error = function(rejection) {\n      if (rejection.status === 400) {\n        _.alert.error(gettext(\"Form contains errors\"));\n        $.extend(self.errors, rejection);\n      } else {\n        _.api.alert(rejection);\n      }\n    };\n  };\n\n  Misago.addService('form:register', function(_) {\n    _.form('register', Register);\n  },\n  {\n    after: 'forms'\n  });\n} (Misago.prototype));\n\n(function (Misago) {\n  'use strict';\n\n  var SignIn = function(_) {\n    var self = this;\n\n    this.showActivation = false;\n\n    this.username = m.prop('');\n    this.password = m.prop('');\n\n    this.validation = {\n      'username': [],\n      'password': []\n    };\n\n    this.clean = function() {\n      if (!_.validate(this)) {\n        _.alert.error(gettext(\"Fill out both fields.\"));\n        return false;\n      } else {\n        return true;\n      }\n    };\n\n    this.submit = function() {\n      _.api.endpoint('auth').post({\n        username: self.username(),\n        password: self.password()\n      }).then(function() {\n        self.success();\n      }, function(error) {\n        self.error(error);\n      });\n    };\n\n    this.success = function() {\n      _.modal();\n\n      var $form = $('#hidden-login-form');\n\n      // refresh CSRF token because api call to /auth/ changed it\n      _.ajax.refreshCsrfToken();\n\n      // fill out form with user credentials and submit it, this will tell\n      // misago to redirect user back to right page, and will trigger browser's\n      // key ring feature\n      $form.find('input[type=\"hidden\"]').val(_.ajax.csrfToken);\n      $form.find('input[name=\"redirect_to\"]').val(m.route());\n      $form.find('input[name=\"username\"]').val(this.username());\n      $form.find('input[name=\"password\"]').val(this.password());\n      $form.submit();\n    };\n\n    this.error = function(rejection) {\n      if (rejection.status === 400) {\n        if (rejection.code === 'inactive_admin') {\n          _.alert.info(rejection.detail);\n        } else if (rejection.code === 'inactive_user') {\n          _.alert.info(rejection.detail);\n          self.showActivation = true;\n        } else if (rejection.code === 'banned') {\n          _.modal();\n          _.router.error403({\n            message: '',\n            ban: rejection.detail\n          });\n        } else {\n          _.alert.error(rejection.detail);\n        }\n      } else {\n        _.api.alert(rejection);\n      }\n    };\n  };\n\n  Misago.addService('form:sign-in', function(_) {\n    _.form('sign-in', SignIn);\n  },\n  {\n    after: 'forms'\n  });\n} (Misago.prototype));\n\n(function (Misago, UrlConf) {\n  'use strict';\n\n  var urls = new UrlConf();\n  urls.url('/', 'index');\n\n  // Legal pages\n  urls.url(\n    '/terms-of-service/',\n    'terms_of_service');\n\n  urls.url(\n    '/privacy-policy/',\n    'privacy_policy');\n\n  // Catch-all 404 not found route\n  urls.url('/:rest...', 'error:404', 'not_found');\n\n  Misago.urls = urls;\n} (Misago.prototype, Misago.prototype.UrlConf));\n"],"sourceRoot":"/source/"}