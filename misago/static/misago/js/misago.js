!function(){"use strict";window.Misago=function(){var t=Object.getPrototypeOf(this),e=this;this.context={SETTINGS:{}},this._initServices=function(r){var n=new t.OrderedList(r).order(!1);n.forEach(function(t){var r=null;r=void 0!==t.item.factory?t.item.factory:t.item;var n=r(e);n&&(e[t.key]=n)})},this._destroyServices=function(r){var n=new t.OrderedList(r).order();n.reverse(),n.forEach(function(t){void 0!==t.destroy&&t.destroy(e)})},this.setup=!1,this.init=function(e){this.setup={fixture:t.get(e,"fixture",null),inTest:t.get(e,"inTest",!1),api:t.get(e,"api","/api/")},this._initServices(t._services)},this.destroy=function(){this._destroyServices(t._services)}};var t=window.Misago.prototype;t._services=[],t.addService=function(e,r,n){t._services.push({key:e,item:r,after:t.get(n,"after"),before:t.get(n,"before")})}}(),function(t){"use strict";t.has=function(t,e){return t?t.hasOwnProperty(e):!1},t.get=function(e,r,n){return t.has(e,r)?e[r]:void 0!==n?n:void 0},t.pop=function(e,r,n){var i=t.get(e,r,n);return t.has(e,r)&&(e[r]=null),i}}(Misago.prototype),function(t){"use strict";t.OrderedList=function(e){this.isOrdered=!1,this._items=e||[],this.add=function(e,r,n){this._items.push({key:e,item:r,after:t.get(n,"after"),before:t.get(n,"before")})},this.get=function(t,e){for(var r=0;r<this._items.length;r++)if(this._items[r].key===t)return this._items[r].item;return e},this.has=function(t){return void 0!==this.get(t)},this.values=function(){for(var t=[],e=0;e<this._items.length;e++)t.push(this._items[e].item);return t},this.order=function(t){return this.isOrdered||(this._items=this._order(this._items),this.isOrdered=!0),t||"undefined"==typeof t?this.values():this._items},this._order=function(t){function e(t){var e=-1;-1===i.indexOf(t.key)&&(t.after?(e=i.indexOf(t.after),-1!==e&&(e+=1)):t.before&&(e=i.indexOf(t.before)),-1!==e&&(n.splice(e,0,t),i.splice(e,0,t.key)))}var r=[];t.forEach(function(t){r.push(t.key)});var n=[],i=[];t.forEach(function(t){t.after||t.before||(n.push(t),i.push(t.key))}),t.forEach(function(t){"_end"===t.before&&(n.push(t),i.push(t.key))});for(var o=200;o>0&&r.length!==i.length;)o-=1,t.forEach(e);return n}}}(Misago.prototype),function(t){t.serializeDatetime=function(t){return t?t.format():null},t.deserializeDatetime=function(t){return t?moment(t):null}}(Misago.prototype),function(t){"use strict";t.startsWith=function(t,e){return 0===t.indexOf(e)},t.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)}}(Misago.prototype),function(t){"use strict";t.UrlConfInvalidComponentError=function(t){this.message="route's "+t+" component should be an array or object",this.toString=function(){return this.message}},t.UrlConf=function(){var e=this;this._patterns=[],this.patterns=function(){return this._patterns};var r=function(t,e){return(t+e).replace("//","/")},n=function(t,n){for(var i=0;i<n.length;i++)e.url(r(t,n[i].pattern),n[i].component,n[i].name)};this.url=function(e,r,i){if("object"!=typeof r)throw new t.UrlConfInvalidComponentError(i);""===e&&(e="/"),r instanceof t.UrlConf?n(e,r.patterns()):this._patterns.push({pattern:e,component:r,name:i})}}}(Misago.prototype),function(t){"use strict";t.loadingPage=function(e){return m(".page.page-loading",e.component(t.Loader))}}(Misago.prototype),function(t){"use strict";var e=function(e){if(-1!==document.cookie.indexOf(e)){var r=new RegExp(e+"=([^;]*)"),n=t.get(document.cookie.match(r),0);return n.split("=")[1]}return null},r=function(r){this.csrfToken=e(r.context.CSRF_COOKIE_NAME);var n={};this.ajax=function(e,r,i,o){var s=m.deferred(),a={url:r,method:e,headers:{"X-CSRFToken":this.csrfToken},data:i|{},dataType:"json",success:function(i){"GET"===e&&t.pop(n,r),s.resolve(i)},error:function(i){"GET"===e&&t.pop(n,r);var o=i.responseJSON||{};o.status=i.status,o.statusText=i.statusText,s.reject(o)}};return o?void 0:($.ajax(a),s.promise)},this.get=function(e){var i=t.pop(r.context,e);if(i){var o=m.deferred();return o.resolve(i),o.promise}return void 0!==n[e]?n[e]:(n[e]=this.ajax("GET",e),n[e])},this.post=function(t,e){return this.ajax("POST",t,e)},this.patch=function(t,e){return this.ajax("PATCH",t,e)},this.put=function(t,e){return this.ajax("PUT",t,e)},this["delete"]=function(t){return this.ajax("DELETE",t)}};t.addService("ajax",function(t){return new r(t)})}(Misago.prototype),function(t){"use strict";var e=function(t){if("object"==typeof t){var e=[];for(var r in t)if(t.hasOwnProperty(r)){var n=encodeURIComponent(r),i=encodeURIComponent(t[r]);e.push(n+"="+i)}return"?"+e.join("&")}return t+"/"},r=function(t,n){this.url=n.url||t.setup.api,this.url+=n.path?n.path+"/":n.related?n.related+"/":n.model+"s/",n.filters&&(this.url+=e(n.filters)),!n.url&&n.filters&&(n.model&&(this.related=function(e,i){return new r(t,{url:this.url,relation:n.model,related:e,filters:i})}),this.endpoint=function(e,n){return new r(t,{url:this.url,path:e,filters:n})}),this.get=function(){var e=null;return n.related?e=n.relation+":"+n.related:n.model&&(e=n.model),t.ajax.get(this.url).then(function(r){return e?r.results?(r.results.map(function(r){return t.models["new"](e,r)}),r):t.models["new"](e,r):r})},this.post=function(e){return t.ajax.post(this.url,e)},this.patch=function(e){return t.ajax.patch(this.url,e)},this.put=function(e){return t.ajax.put(this.url,e)},this["delete"]=function(){return t.ajax["delete"](this.url)},this.then=function(t,e){return this.get().then(t,e)}},n=function(t){this.model=function(e,n){return new r(t,{model:e,filters:n})},this.endpoint=function(e,n){return new r(t,{path:e,filters:n})}};t.addService("api",function(t){return new n(t)})}(Misago.prototype),function(t){"use strict";t.addService("component-factory",function(t){t.component=function(){for(var e=[],r=0;r<arguments.length;r+=1)e.push(arguments[r]);return e.push(t),m.component.apply(void 0,e)}})}(Misago.prototype),function(t){"use strict";t.addService("conf",function(e){e.settings=t.get(e.context,"SETTINGS",{})})}(Misago.prototype),function(t){"use strict";t.addService("forum-layout",{factory:function(e){e.setup.fixture&&m.mount(document.getElementById(e.setup.fixture),e.component(t.ForumLayout))},destroy:function(t){t.setup.fixture&&m.mount(t.setup.fixture,null)}},{before:"start-routing"})}(Misago.prototype),function(t){"use strict";var e=function(){this.classes={},this.deserializers={},this.relations={},this.add=function(t,e){if(e["class"]&&(this.classes[t]=e["class"]),e.deserialize&&(this.deserializers[t]=e.deserialize),e.relations)for(var r in e.relations)e.relations.hasOwnProperty(r)&&(this.relations[t+":"+r]=e.relations[r])},this["new"]=function(t,e){return this.classes[t]?new this.classes[t](e):e},this.deserialize=function(t,e){return this.relations[t]&&(t=this.relations[t]),this.deserializers[t]?this["new"](t,this.deserializers[t](e,this)):this["new"](t,e)}};t.addService("models",function(){return new e})}(Misago.prototype),function(t){"use strict";t.addService("set-momentjs-locale",function(){moment.locale($("html").attr("lang"))})}(Misago.prototype),function(t){"use strict";var e=function(){};t.route=function(r){r.isActive=!0;var n=r.controller||e;if(r.controller=function(){r.isActive=!0;var t=n.apply(r,arguments)||{},i=t.onunload||e;return t.onunload=function(){i.apply(r,arguments),r.isActive=!1},t},r.vm&&r.vm.init){var i=r.vm.init;r.vm.init=function(){var t=arguments,e=i.apply(r.vm,t);e&&e.then(function(){if(r.isActive&&r.vm.ondata){for(var e=[],n=0;n<arguments.length;n++)e.push(arguments[n]);for(var i=0;i<t.length;i++)e.push(t[i]);r.vm.ondata.apply(r.vm,e)}},function(t){r.isActive&&r.container.router.errorPage(t)})},r.loading||(r.loading=function(){var e=this.container;return m(".page.page-loading",e.component(t.Loader))});var o=r.view;r.view=function(){return r.vm.isReady?o.apply(r,arguments):r.loading.apply(r,arguments)}}return r}}(Misago.prototype),function(t){"use strict";var e=function(e){var r=this;this.baseUrl=$("base").attr("href");var n=t.get(e.context,"STATIC_URL","/"),i=t.get(e.context,"MEDIA_URL","/");this.urls={},this.reverses={};var o=function(t){return t.container=e,t},s=function(t){t.patterns().forEach(function(t){var e=r.baseUrl+t.pattern;e=e.replace("//","/"),r.urls[e]=o(t.component),r.reverses[t.name]=e})};this.startRouting=function(t,e){s(t),this.fixture=e,m.route.mode="pathname",m.route(e,"/",this.urls)},this.url=function(t){return this.reverses[t]},this.delegateElement=null,this.delegateName="click.misago-router",this.cleanUrl=function(t){if(t){var e="/"===t.substr(0,1)&&"//"!==t.substr(0,2);if(!e){var r=window.location;if("//"!==t.substr(0,2)){var o=t.substr(0,r.protocol.length+2);if(o!==r.protocol+"//")return;t=t.substr(r.protocol.length+2)}else t=t.substr(2);if(t.substr(0,r.host.length)!==r.host)return;t=t.substr(r.host.length)}if(t.substr(0,this.baseUrl.length)===this.baseUrl&&t.substr(0,n.length)!==n&&t.substr(0,i.length)!==i){var s="/user-avatar/";if(t.substr(0,s.length)!==s)return t}}},this.delegateClicks=function(t){this.delegateElement=t,$(this.delegateElement).on(this.delegateName,"a",function(t){var e=r.cleanUrl(t.target.href);e&&(e!=m.route()&&m.route(e),t.preventDefault())})},this.destroy=function(){$(this.delegateElement).off(this.delegateName)};var a=function(t){return function(e){return t+e}};this.staticUrl=a(n),this.mediaUrl=a(i),this.error403=function(r){var n=null;r.ban?(n=o(t.ErrorBannedRoute),n.error={message:r.detail,ban:e.models.deserialize("ban",r.ban)}):(n=o(t.Error403Route),n.error=r.detail),m.mount(this.fixture,n)},this.error404=function(){m.mount(this.fixture,o(t.Error404Route))},this.error500=function(){m.mount(this.fixture,o(t.Error500Route))},this.error0=function(){m.mount(this.fixture,o(t.Error0Route))},this.errorPage=function(t){0===t.status&&this.error0(),500===t.status&&this.error500(),404===t.status&&this.error404(),403===t.status&&this.error403(t)}};t.addService("router",function(t){return new e(t)}),t.addService("start-routing",function(e){e.router.startRouting(t.urls,document.getElementById("router-fixture")),e.router.delegateClicks(document.getElementById(e.setup.fixture))},{before:"_end"})}(Misago.prototype),function(t){"use strict";var e=function(t){var e=this;this._intervals={};var r=function(t){e._intervals[t]&&(window.clearTimeout(e._intervals[t]),e._intervals[t]=null)};this.run=function(n,i,o){this._intervals[i]=window.setTimeout(function(){r(i);var s=n(t);s!==!1&&e.run(n,i,o)},o)},this.runOnce=function(e,n,i){this._intervals[n]=window.setTimeout(function(){r(n),e(t)},i)},this.stop=function(t){for(var e in this._intervals)t&&t!==e||r(e)}};t.addService("runloop",{factory:function(t){return new e(t)},destroy:function(t){t.runloop.stop()}})}(Misago.prototype),function(t){"use strict";t.addService("start-tick",function(t){var e=m.prop();t.runloop.run(function(){m.startComputation(),e(e()+1),m.endComputation()},"tick",6e4)})}(Misago.prototype),function(t){"use strict";var e=function(t){this.set=function(e){e?this._set_complex(e):document.title=t},this._set_complex=function(e){"string"==typeof e&&(e={title:e});var r=e.title;if("undefined"!=typeof e.page&&e.page>1){var n=interpolate(gettext("page %(page)s"),{page:e.page},!0);r+=" ("+n+")"}"undefined"!=typeof e.parent&&(r+=" | "+e.parent),document.title=r+" | "+t}};t.addService("page-title",function(t){t.title=new e(t.settings.forum_name)})}(Misago.prototype),function(t){"use strict";var e=function(t){this.message={html:t.message.html,plain:t.message.plain},this.expires_on=t.expires_on},r=function(e){return e.expires_on=t.deserializeDatetime(e.expires_on),new t.Ban(e)};t.addService("ban-model",function(t){t.models.add("ban",{"class":e,deserialize:r})},{after:"models"})}(Misago.prototype),function(t){"use strict";var e=function(t){this.title=t.title,this.body=t.body};t.addService("legal-page-model",function(t){t.models.add("legal-page",{"class":e})},{after:"models"})}(Misago.prototype),function(t){"use strict";var e=function(t){var e=[m("p.lead",t.message)];return t.help&&e.push(m("p.help",t.help)),m(".page.error-page.error-"+t.code+"-page",m(".container",m(".error-panel",[m(".error-icon",m("span.material-icon",t.icon)),m(".error-message",e)])))};t.ErrorBannedRoute=t.route({controller:function(){this.container.title.set(gettext("You are banned"))},error:null,view:function(){var t=[];t.push(this.error.ban.message.html?m(".lead",m.trust(this.error.ban.message.html)):m("p.lead",this.error.message));var e=null;return e=this.error.ban.expires_on?this.error.ban.expires_on.isAfter(moment())?interpolate(gettext("This ban expires %(expires_on)s."),{expires_on:this.error.ban.expires_on.fromNow()},!0):gettext("This ban has expired."):gettext("This ban is permanent."),t.push(m("p",e)),m(".page.error-page.error-banned-page",m(".container",m(".error-panel",[m(".error-icon",m("span.material-icon","highlight_off")),m(".error-message",t)])))}}),t.Error403Route=t.route({controller:function(){this.container.title.set(gettext("Page not available"))},error:null,view:function(){return e({code:403,icon:"remove_circle_outline",message:gettext("This page is not available."),help:this.error||gettext("You don't have permission to access this page.")})}}),t.Error404Route=t.route({controller:function(){this.container.title.set(gettext("Page not found"))},view:function(){return e({code:404,icon:"info_outline",message:gettext("Requested page could not be found."),help:gettext("The link you followed was incorrect or the page has been moved or deleted.")})}}),t.Error500Route=t.route({controller:function(){this.container.title.set(gettext("Application error occured"))},view:function(){return e({code:500,icon:"error_outline",message:gettext("Requested page could not be displayed due to an error."),help:gettext("Please try again later or contact site staff if error persists.")})}}),t.Error0Route=t.route({controller:function(){this.container.title.set(gettext("Lost connection with application"))},view:function(){return e({code:500,icon:"sync_problem",message:gettext("Could not connect to application."),help:gettext("This may be caused by problems with your connection or application server. Please check your internet connection and refresh page if problem persists.")})}})}(Misago.prototype),function(t){"use strict";t.IndexRoute=t.route({controller:function(){var t=this.container;document.title=t.settings.forum_index_title||t.settings.forum_name;var e=m.prop(0);return{count:e,increment:function(){console.log("increment()"),e(e()+1)}}},view:function(t){return m(".container",[m("h1",["Count: ",m("strong",t.count())]),m("p","Clicky click button to increase count!."),m("p",m("button.btn.btn-primary",{onclick:t.increment},"Clicky clicky!"))])}})}(Misago.prototype),function(t){"use strict";var e=function(e,r){var n=e.replace(/_/g,"-");return t.route({controller:function(){var r=this.container;t.get(r.settings,e+"_link")?window.location=t.get(r.settings,e+"_link"):this.vm.init(this,r)},vm:{page:null,isReady:!1,init:function(t,e){return this.isReady?void e.title.set(this.title):(e.title.set(),e.api.model("legal-page",n))},ondata:function(t,e,n){m.startComputation(),t.title=t.title||r,this.page=t,this.isReady=!0,m.endComputation(),e.isActive&&n.title.set(this.page.title)}},view:function(){var e=this.container;return m(".page.legal-page."+n+"-page",[e.component(t.PageHeader,{title:this.vm.page.title}),m(".container",e.component(t.Markup,this.vm.page.body))])}})};t.TermsOfServiceRoute=e("terms_of_service",gettext("Terms of service")),t.PrivacyPolicyRoute=e("privacy_policy",gettext("Privacy policy"))}(Misago.prototype),function(t){"use strict";var e=function(e,r,n){var i=t.get(e.settings,r+"_link");return!i&&t.get(e.settings,r)&&(i=e.router.url(r)),i?m("li",m("a",{href:i},t.get(e.settings,r+"_title",n))):null};t.FooterNav={isVisible:function(t){return-1!==[!!t.forum_footnote,!!t.terms_of_service,!!t.terms_of_service_link,!!t.privacy_policy,!!t.privacy_policy_link].indexOf(!0)},view:function(t,r){var n=[];return r.settings.forum_footnote&&n.push(m("li.forum-footnote",m.trust(r.settings.forum_footnote))),n.push(e(r,"terms_of_service",gettext("Terms of service"))),n.push(e(r,"privacy_policy",gettext("Privacy policy"))),m("ul.list-inline.footer-nav",n)}}}(Misago.prototype),function(t){"use strict";t.ForumFooter={view:function(e,r){var n=null;return t.FooterNav.isVisible(r.settings)&&(n=r.component(t.FooterNav)),m("footer.forum-footer",[m(".container",m(".footer-content",[n,r.component(t.FooterMisagoBranding)]))])}}}(Misago.prototype),function(t){"use strict";t.FooterMisagoBranding={view:function(){return m("a.misago-branding[href=http://misago-project.org]",["powered by ",m("strong","misago")])}}}(Misago.prototype),function(t){"use strict";t.BrandFull={view:function(t,e,r){var n=[m("img",{src:r.router.staticUrl("misago/img/site-logo.png"),alt:r.settings.forum_name})];return e&&n.push(e),m("a.navbar-brand",{href:r.router.url("index")},n)}}}(Misago.prototype),function(t){"use strict";t.ForumNavbar={view:function(e,r){var n=[];r.settings.forum_branding_display&&n.push(r.component(t.BrandFull,r.settings.forum_branding_text)),n.push(m("ul.nav.navbar-nav",[m("li",m("a",{config:m.route,href:r.router.url("index")},"Index"))]));var i=".navbar.navbar-default.navbar-static-top";return m("nav"+i+'[role="navigation"]',[m(".container.navbar-full.hidden-xs.hidden-sm",n)])}}}(Misago.prototype),function(t){"use strict";var e=function(t,e,r){r.retain=!0};t.ForumLayout={view:function(r,n){return[n.component(t.ForumNavbar),m("#router-fixture",{config:e}),n.component(t.ForumFooter)]}}}(Misago.prototype),function(t){"use strict";t.Loader={view:function(){return m(".loader.sk-folding-cube",[m(".sk-cube1.sk-cube"),m(".sk-cube2.sk-cube"),m(".sk-cube4.sk-cube"),m(".sk-cube3.sk-cube")])}},t.LoadingPage={view:function(e,r){return m(".page.loading-page",r.component(t.Loader))}}}(Misago.prototype),function(t){"use strict";var e=function(t,e,r){r.retain=!0};t.Markup={view:function(t,r){return m("article.misago-markup",{config:e},m.trust(r))}}}(Misago.prototype),function(t){"use strict";t.PageHeader={view:function(t,e){return m(".page-header",m(".container",[m("h1",e.title)]))}}}(Misago.prototype),function(t,e){"use strict";var r=new e;r.url("/",t.IndexRoute,"index"),r.url("/terms-of-service/",t.TermsOfServiceRoute,"terms_of_service"),r.url("/privacy-policy/",t.PrivacyPolicyRoute,"privacy_policy"),t.urls=r}(Misago.prototype,Misago.prototype.UrlConf);
//# sourceMappingURL=/misago.js.map