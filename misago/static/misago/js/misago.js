!function(){"use strict";window.Misago=function(){var t=Object.getPrototypeOf(this),e=this;this.context={SETTINGS:{}},this._services=[],this.addService=function(t,e,r){this._services.push({name:t,item:e,after:this.get(r,"after"),before:this.get(r,"before")})},this._initServices=function(r){var i=new t.OrderedList(r).order(!1);i.forEach(function(t){var r=null;r=void 0!==t.item.factory?t.item.factory:t.item;var i=r(e);i&&(e[t.name]=i)})},this._destroyServices=function(r){var i=new t.OrderedList(r).order();i.reverse(),i.forEach(function(t){void 0!==t.destroy&&t.destroy(e)})},this.registerCoreServices=function(){this.addService("conf",t.Conf),this.addService("component",t.ComponentFactory),this.addService("router",t.RouterFactory),this.addService("api",t.Api),this.addService("outlet",t.Outlet),this.addService("title",t.PageTitle),this.addService("start-routing",t.startRouting)},this.setup=!1,this.init=function(e){this.setup={fixture:t.get(e,"fixture",null),in_test:t.get(e,"in_test",!1)},this._initServices(this._services)},this.destroy=function(){this._destroyServices()}}}(),function(t){"use strict";var e=function(t,e,r){r.retain=!0};t.ForumLayout={view:function(r,i){return[i.component(t.ForumNavbar),m("#router-fixture",{config:e}),i.component(t.ForumFooter)]}}}(Misago.prototype),function(t){"use strict";var e={controller:function(){var t=e.container;t.setTitle(t.settings.forum_index_title)},view:function(){return m(".container",[m("h1","Forum index page!"),m("p","Lorem ipsum dolor met sit amet elit."),m("p","Sequar elit dolor nihi putto.")])}};t.IndexPage=e}(Misago.prototype),function(t){"use strict";var e=function(e,r){var i=e.replace(/_/g,"-"),n={is_destroyed:!0,controller:function(){var r=n.container;return n.is_destroyed=!1,t.get(r.settings,e+"_link")?window.location=t.get(r.settings,e+"_link"):n.vm.init(r),{onunload:function(){n.is_destroyed=!0}}},vm:{is_busy:!1,is_ready:!1,content:null,init:function(t){var e=this;e.is_ready?t.setTitle(e.title):(t.setTitle(),e.is_busy||(e.is_busy=!0,t.api.one("legal-pages",i).then(function(i){e.title=i.title||r,e.body=i.body,e.is_busy=!1,e.is_ready=!0,n.is_destroyed||(t.setTitle(e.title),m.redraw())})))}},view:function(){var e=this.container;return this.vm.is_ready?m(".page.page-legal.page-legal-"+i,[e.component(t.PageHeader,{title:this.vm.title}),m(".container",m.trust(this.vm.body))]):e.component(t.LoadingPage)}};return n};t.TermsOfServicePage=e("terms_of_service",gettext("Terms of service")),t.PrivacyPolicyPage=e("privacy_policy",gettext("Privacy policy"))}(Misago.prototype),function(t){"use strict";t.Loader={view:function(){return m(".loader.sk-folding-cube",[m(".sk-cube1.sk-cube"),m(".sk-cube2.sk-cube"),m(".sk-cube4.sk-cube"),m(".sk-cube3.sk-cube")])}},t.LoadingPage={view:function(e,r){return m(".page.page-loading",r.component(t.Loader))}}}(Misago.prototype),function(t){"use strict";var e=function(t,e,r){r.retain=!0};t.MisagoMarkup={view:function(t,r){return m("article.misago-markup",{config:e},m.trust(r))}}}(Misago.prototype),function(t){"use strict";t.PageHeader={view:function(t,e){return m(".page-header",m(".container",[m("h1",e.title)]))}}}(Misago.prototype),function(t){"use strict";var e=function(e,r,i){var n=t.get(e.settings,r+"_link");return!n&&t.get(e.settings,r)&&(n=e.router.url(r)),n?m("li",m("a",{href:n},t.get(e.settings,r+"_title",i))):null};t.FooterNav={isVisible:function(t){return-1!==[!!t.forum_footnote,!!t.terms_of_service,!!t.terms_of_service_link,!!t.privacy_policy,!!t.privacy_policy_link].indexOf(!0)},view:function(t,r){var i=[];return r.settings.forum_footnote&&i.push(m("li.forum-footnote",m.trust(r.settings.forum_footnote))),i.push(e(r,"terms_of_service",gettext("Terms of service"))),i.push(e(r,"privacy_policy",gettext("Privacy policy"))),m("ul.list-inline.footer-nav",i)}}}(Misago.prototype),function(t){"use strict";t.ForumFooter={view:function(e,r){var i=null;return t.FooterNav.isVisible(r.settings)&&(i=r.component(t.FooterNav)),m("footer.forum-footer",[m(".container",m(".footer-content",[i,r.component(t.FooterMisagoBranding)]))])}}}(Misago.prototype),function(t){"use strict";t.FooterMisagoBranding={view:function(){return m("a.misago-branding[href=http://misago-project.org]",["powered by ",m("strong","misago")])}}}(Misago.prototype),function(t){"use strict";t.BrandFull={view:function(t,e,r){var i=[m("img",{src:r.router.staticUrl("misago/img/site-logo.png"),alt:r.settings.forum_name})];return e&&i.push(e),m("a.navbar-brand",{href:r.router.url("index")},i)}}}(Misago.prototype),function(t){"use strict";t.ForumNavbar={view:function(e,r){var i=[];return r.settings.forum_branding_display&&i.push(r.component(t.BrandFull,r.settings.forum_branding_text)),i.push(m("ul.nav.navbar-nav",[m("li",m("a",{config:m.route,href:r.router.url("index")},"Index")),m("li",m("a",{config:m.route,href:r.router.url("test")},"Test"))])),m('nav.navbar.navbar-default.navbar-static-top[role="navigation"]',[m(".container.navbar-full.hidden-xs.hidden-sm",i)])}}}(Misago.prototype),function(t){"use strict";var e=function(e){var r=new RegExp(e.context.CSRF_COOKIE_NAME+"=([^;]*)");this.csrf_token=t.get(document.cookie.match(r),0).split("=")[1],this.ajax=function(t,e,r,i){var n=m.deferred(),o={url:e,method:t,headers:{"X-CSRFToken":this.csrf_token},data:r|{},dataType:"json",success:function(t){n.resolve(t)},error:function(t){n.reject(t)}};return i?void 0:($.ajax(o),n.promise)},this.get=function(r){var i=t.pop(e.preloaded_data,r);if(i){var n=m.deferred();return n.resolve(i),n.promise}return this.ajax("GET",r)},this.post=function(t){return this.ajax("POST",t)},this.buildUrl=function(t,r,i){var n=e.router.base_url;return n+="api/"+t+"/"},this.one=function(t,e){var r=this.buildUrl(t)+e+"/";return this.get(r)},this.many=function(t,e){},this.call=function(t,e,r,i){}};t.Api=function(t){return new e(t)}}(Misago.prototype),function(t){"use strict";t.ComponentFactory=function(t){t.component=function(){for(var e=[],r=0;r<arguments.length;r+=1)e.push(arguments[r]);return e.push(t),m.component.apply(void 0,e)}}}(Misago.prototype),function(t){"use strict";t.Conf=function(e){e.settings=t.get(e.context,"SETTINGS",{})}}(Misago.prototype),function(t){"use strict";t.Outlet={factory:function(e){e.setup.fixture&&m.mount(document.getElementById(e.setup.fixture),e.component(t.ForumLayout))},destroy:function(t){t.setup.fixture&&m.mount(t.setup.fixture,null)}}}(Misago.prototype),function(t){"use strict";var e=function(e){var r=this;this.base_url=$("base").attr("href"),this.static_url=t.get(e.context,"STATIC_URL","/"),this.media_url=t.get(e.context,"MEDIA_URL","/"),this.urls={},this.reverses={};var i=function(t){t.patterns().forEach(function(t){t.component.container=e;var i=r.base_url+t.pattern;i=i.replace("//","/"),r.urls[i]=t.component,r.reverses[t.name]=i})};this.startRouting=function(t,e){i(t),this.fixture=e,m.route.mode="pathname",m.route(e,"/",this.urls)},this.url=function(t){return this.reverses[t]},this.delegate_element=null,this.delegate_name="click.misago-router",this.cleanUrl=function(t){if(t){var e="/"===t.substr(0,1)&&"//"!==t.substr(0,2);if(!e){var r=window.location;if("//"!==t.substr(0,2)){var i=t.substr(0,r.protocol.length+2);if(i!==r.protocol+"//")return;t=t.substr(r.protocol.length+2)}else t=t.substr(2);if(t.substr(0,r.host.length)!==r.host)return;t=t.substr(r.host.length)}if(t.substr(0,this.base_url.length)===this.base_url&&t.substr(0,this.static_url.length)!==this.static_url&&t.substr(0,this.media_url.length)!==this.media_url){var n="/user-avatar/";if(t.substr(0,n.length)!==n)return t}}},this.delegateClicks=function(t){this.delegate_element=t,$(this.delegate_element).on(this.delegate_name,"a",function(t){var e=r.cleanUrl(t.target.href);e&&(e!=m.route()&&m.route(e),t.preventDefault())})},this.destroy=function(){$(this.delegate_element).off(this.delegate_name)};var n=function(t){return function(e){return t+e}};this.staticUrl=n(this.static_url),this.mediaUrl=n(this.media_url)};t.RouterFactory=function(t){return new e(t)},t.startRouting=function(e){e.router.startRouting(t.urls,document.getElementById("router-fixture")),e.router.delegateClicks(document.getElementById(e.setup.fixture))}}(Misago.prototype),function(t){"use strict";t.PageTitle=function(t){t._setTitle=function(t){"string"==typeof t&&(t={title:t});var e=t.title;"undefined"!=typeof t.page&&t.page>1&&(e+=" ("+interpolate(gettext("page %(page)s"),{page:t.page},!0)+")"),"undefined"!=typeof t.parent&&(e+=" | "+t.parent),document.title=e+" | "+this.settings.forum_name},t.setTitle=function(t){t?this._setTitle(t):document.title=this.settings.forum_name}}}(Misago.prototype),function(t){"use strict";t.has=function(t,e){return void 0!==t?t.hasOwnProperty(e):!1},t.get=function(e,r,i){return t.has(e,r)?e[r]:void 0!==i?i:void 0},t.pop=function(e,r,i){var n=t.get(e,r,i);return t.has(e,r)&&delete e[r],n}}(Misago.prototype),function(t){"use strict";t.OrderedList=function(e){this.is_ordered=!1,this._items=e||[],this.add=function(e,r,i){this._items.push({key:e,item:r,after:t.get(i,"after"),before:t.get(i,"before")})},this.get=function(t,e){for(var r=0;r<this._items.length;r++)if(this._items[r].key===t)return this._items[r].item;return e},this.has=function(t){return void 0!==this.get(t)},this.values=function(){for(var t=[],e=0;e<this._items.length;e++)t.push(this._items[e].item);return t},this.order=function(t){return this.is_ordered||(this._items=this._order(this._items),this.is_ordered=!0),t||"undefined"==typeof t?this.values():this._items},this._order=function(t){function e(t){var e=-1;-1===n.indexOf(t.key)&&(t.after?(e=n.indexOf(t.after),-1!==e&&(e+=1)):t.before&&(e=n.indexOf(t.before)),-1!==e&&(i.splice(e,0,t),n.splice(e,0,t.key)))}var r=[];t.forEach(function(t){r.push(t.key)});var i=[],n=[];t.forEach(function(t){t.after||t.before||(i.push(t),n.push(t.key))});for(var o=200;o>0&&r.length!==n.length;)o-=1,t.forEach(e);return i}}}(Misago.prototype),function(t){"use strict";t.startsWith=function(t,e){return 0===t.indexOf(e)},t.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)}}(Misago.prototype),function(t){"use strict";t.UrlConfInvalidComponentError=function(){this.message="component argument should be array or object"},t.UrlConf=function(){var e=this;this._patterns=[],this.patterns=function(){return this._patterns};var r=function(t,e){return(t+e).replace("//","/")},i=function(t,i){for(var n=0;n<i.length;n++)e.url(r(t,i[n].pattern),i[n].component,i[n].name)};this.url=function(e,r,n){if("object"!=typeof r)throw new t.UrlConfInvalidComponentError;""===e&&(e="/"),r instanceof t.UrlConf?i(e,r.patterns()):this._patterns.push({pattern:e,component:r,name:n})}}}(Misago.prototype),function(t){"use strict";t.loadingPage=function(e){return m(".page.page-loading",e.component(t.Loader))}}(Misago.prototype),function(t,e){"use strict";var r=new e;r.url("/",t.IndexPage,"index"),r.url("/terms-of-service/",t.TermsOfServicePage,"terms_of_service"),r.url("/privacy-policy/",t.PrivacyPolicyPage,"privacy_policy"),t.urls=r}(Misago.prototype,Misago.prototype.UrlConf);
//# sourceMappingURL=/misago.js.map